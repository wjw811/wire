# Wire项目Nginx配置
# 在phpstudy_pro的nginx.conf中添加: include nginx_wire.conf;

server {
    listen 8000;
    server_name 192.168.6.123 _;
    root E:/test2/wire2/wire;
    index index.php index.html;
    
    # 字符集
    charset utf-8;
    
    # 静态文件直接处理（JS、CSS、图片、字体等）
    location ~* \.(js|css|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot|json|map)$ {
        expires 1h;
        add_header Cache-Control "public, max-age=3600";
        access_log off;
    }
    
    # 前端路由 - Vue Router的history模式
    location /static/admin {
        alias E:/test2/wire2/wire/static/admin;
        try_files $uri $uri/ /static/admin/index.html;
    }
    
    # PHP API请求 - 反向代理到PHP内置服务器（当前方案）
    # 注意：PHP需要在8001端口运行（Nginx使用8000端口）
    location ~ ^/(admin|rpc|api|pub|~)/ {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_buffering off;
    }
    
    # PHP文件请求
    location ~ \.php$ {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_buffering off;
    }
    
    # index.php
    location = /index.php {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_buffering off;
    }
    
    # 其他请求（如favicon.ico等）
    location / {
        try_files $uri $uri/ =404;
    }
}

