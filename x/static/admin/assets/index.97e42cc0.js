var i=(B,x,a)=>new Promise((v,d)=>{var h=l=>{try{F(a.next(l))}catch(f){d(f)}},C=l=>{try{F(a.throw(l))}catch(f){d(f)}},F=l=>l.done?v(l.value):Promise.resolve(l.value).then(h,C);F((a=a.apply(B,x)).next())});import{i as P,as as R,h as K}from"./index.69a4dfca.js";import{a as X}from"./index.bff03604.js";import Y from"./GrowCard.4c38539e.js";import Z from"./DevBox.386e36b4.js";import uu from"./BarChart.13197fff.js";import{g as eu}from"./index.cac8beb7.js";import{d as y,g as k}from"./data.080f0cdf.js";import{d as ou,k as c,o as lu,b as nu,U as tu,a1 as S,a7 as su,a9 as b,a3 as s,f as p,E as w,a4 as t,a2 as L,V as j,u as z,a6 as au}from"./vue.2e68d871.js";import"./utils.93213dc9.js";import"./ui.5d3da833.js";import"./table.68230543.js";/* empty css                *//* empty css                */import"./useWindowSizeFn.d3b17bbd.js";import"./useContentViewHeight.d0ccb353.js";/* empty css                *//* empty css                *//* empty css               */import"./index.data.ff8161d5.js";import"./index.35535828.js";import"./gateway.2a62e783.js";import"./data.71aa74fd.js";import"./index.3a1d8258.js";import"./DevParam.4701652e.js";import"./useForm.d0703219.js";/* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               */import"./index.e662be6d.js";import"./download.20060076.js";import"./index.8ca31aa0.js";import"./useECharts.4e74db27.js";import"./charts.e5d90eae.js";const ru=B=>P.get({url:"/bridge/start",params:B}),iu=B=>P.get({url:"/bridge/stop",params:B}),cu=B=>P.get({url:"/bridge/status",params:B}),du={style:{background:"#f0f8ff",padding:"15px",margin:"10px",border:"1px solid #1890ff","border-radius":"6px"}},Fu={style:{display:"flex","align-items":"center",gap:"10px","flex-wrap":"wrap"}},fu={key:0,style:{color:"#52c41a","font-weight":"bold"}},Eu={key:1,style:{color:"#999"}},Au={key:0,style:{"margin-top":"10px","font-size":"12px",color:"#666"}},gu={key:0},pu={style:{background:"#fff3cd",padding:"10px",margin:"10px",border:"1px solid #ffeaa7","border-radius":"4px"}},Bu={style:{"margin-top":"10px"}},ne=ou({__name:"index",setup(B){const x=c(!1),a=c(!1),v=c(!1),d=c("\u672A\u8FDE\u63A5"),h=c("\u65E0"),C=c(!1),F=c(!1),l=c(!1),f=c(null),r=c(null),{createMessage:E}=K();let D=null,_=null;const U=()=>i(this,null,function*(){if(!a.value){a.value=!0,d.value="\u8FDE\u63A5\u4E2D...";try{const{DirectConnection:u}=yield R(()=>import("./directConnection.49abe139.js"),["assets/directConnection.49abe139.js","assets/index.35535828.js","assets/index.69a4dfca.js","assets/index.ae15d376.css","assets/utils.93213dc9.js","assets/ui.5d3da833.js","assets/vue.2e68d871.js","assets/table.68230543.js"]);D=new u,(yield D.connect(1)).connected?(v.value=!0,d.value="\u5DF2\u8FDE\u63A5",window.manualConn=D,setTimeout(()=>{var n;const o=document.querySelectorAll("button");for(let A=0;A<o.length;A++)if(o[A].textContent.includes("\u624B\u52A8\u67E5\u8BE2")){const g=o[A],m=g.cloneNode(!0);(n=g.parentNode)==null||n.replaceChild(m,g),m.addEventListener("click",T=>{T.preventDefault(),T.stopPropagation(),T.stopImmediatePropagation(),M()},!0),m.textContent="\u624B\u52A8\u67E5\u8BE2 (\u5DF2\u8FDE\u63A5\u2713)",m.style.background="#52c41a",m.style.color="white",m.style.border="none";break}},200),D.onMessage(o=>{if(o instanceof ArrayBuffer){const n=Array.from(new Uint8Array(o)).map(A=>A.toString(16).padStart(2,"0")).join(" ").toUpperCase();h.value=new Date().toLocaleTimeString()}}),yield V(),_&&clearInterval(_),_=setInterval(()=>i(this,null,function*(){yield V()}),3e3)):d.value="\u8FDE\u63A5\u5931\u8D25"}catch(u){d.value="\u8FDE\u63A5\u5F02\u5E38"}finally{a.value=!1}}}),V=()=>i(this,null,function*(){const u=window.manualConn||D;if(!!u)try{const e="AA010541564B0615",o=new Uint8Array(e.match(/.{2}/g).map(A=>parseInt(A,16))),n=u.send(o.buffer)}catch(e){}}),M=()=>i(this,null,function*(){try{const u=new WebSocket("ws://127.0.0.1:18900");u.onopen=function(){const e="AA010541564B0615",o=new Uint8Array(e.match(/.{2}/g).map(n=>parseInt(n,16)));u.send(o.buffer)},u.onmessage=function(e){e.data instanceof Blob&&e.data.arrayBuffer().then(o=>{const n=new Uint8Array(o),A=Array.from(n).map(g=>g.toString(16).padStart(2,"0")).join(" ").toUpperCase();try{R(()=>import("./directDataProcessor.5aa063e2.js"),["assets/directDataProcessor.5aa063e2.js","assets/index.35535828.js","assets/index.69a4dfca.js","assets/index.ae15d376.css","assets/utils.93213dc9.js","assets/ui.5d3da833.js","assets/vue.2e68d871.js","assets/table.68230543.js"]).then(T=>i(this,[T],function*({processDirectDeviceData:g,convertToDevBoxFormat:m}){const H=yield g(o,["f01","f02","f03","f04","f05","f06","f07","f08","f09","f10","f11","f12","f13","f14","f15","f16","f17","f18","f19","f20","f21","f22","f23","f24","f25","f26","f27","f28","f29","f30","f31","f32","f33","f34","f35","f36","f37","f38","f39","f40","f41","f42","f43","f44","f45","f46","f47","f48","f49","f50","f51","f52","f53","f54","f55","f56","f57","f58","f59","f60"],"zh"),W=m(H);if(y.value&&y.value.length>0){const I=y.value.findIndex(J=>J.id===1);I!==-1&&(y.value[I].data=W.data,y.value[I].limit=W.limit,y.value[I].time=new Date().toLocaleTimeString())}})).catch(g=>{})}catch(g){}h.value=new Date().toLocaleTimeString()+" - \u5B8C\u6574\u7248(f01-f60)"})},u.onerror=function(e){},u.onclose=function(e){}}catch(u){}}),N=()=>{_&&(clearInterval(_),_=null),D&&(D.disconnect(),D=null),v.value=!1,d.value="\u5DF2\u65AD\u5F00",h.value="\u65E0"},q=()=>i(this,null,function*(){if(!C.value){C.value=!0;try{const u=yield ru({ip:"10.10.100.254",port:18899,bridge_port:18900});u.code===0?(l.value=!0,f.value=u.data.pid,r.value=u.data,E.success("\u6865\u63A5\u670D\u52A1\u542F\u52A8\u6210\u529F\uFF01")):E.error(u.message)}catch(u){E.error("\u542F\u52A8\u6865\u63A5\u670D\u52A1\u5931\u8D25")}finally{C.value=!1}}}),O=()=>i(this,null,function*(){if(!F.value){F.value=!0;try{const u=yield iu({bridge_port:18900});u.code===0?(l.value=!1,f.value=null,r.value=null,E.success("\u6865\u63A5\u670D\u52A1\u5DF2\u505C\u6B62")):E.error(u.message)}catch(u){E.error("\u505C\u6B62\u6865\u63A5\u670D\u52A1\u5931\u8D25")}finally{F.value=!1}}}),$=()=>i(this,null,function*(){try{const u=yield cu({bridge_port:18900});u.code===0?(l.value=!0,f.value=u.data.pid,r.value=u.data,E.success("\u6865\u63A5\u670D\u52A1\u8FD0\u884C\u6B63\u5E38")):(l.value=!1,f.value=null,r.value=null,E.warning("\u6865\u63A5\u670D\u52A1\u672A\u8FD0\u884C"))}catch(u){E.error("\u68C0\u67E5\u6865\u63A5\u72B6\u6001\u5931\u8D25")}}),Q=u=>{const e=Math.floor(u/3600),o=Math.floor(u%3600/60),n=u%60;return e>0?`${e}\u5C0F\u65F6${o}\u5206\u949F`:o>0?`${o}\u5206\u949F${n}\u79D2`:`${n}\u79D2`};function G(){return i(this,null,function*(){try{const{total:e,info:o}=yield eu();k.value[0].value=e.dev,k.value[1].value=e.task,k.value[2].value=e.node,k.value[3].value=e.gw,y.value=o,setTimeout(()=>{U()},3e3)}catch(e){}})}return lu(()=>{G(),$()}),nu(()=>{N()}),(u,e)=>{const o=tu("a-button");return S(),su(z(X),null,{default:b(()=>{var n;return[s("div",du,[e[1]||(e[1]=s("h4",{style:{margin:"0 0 10px 0",color:"#1890ff"}},"\u{1F310} \u5C40\u57DF\u7F51\u76F4\u8FDE\u63A7\u5236",-1)),s("div",Fu,[p(o,{type:"primary",size:"small",onClick:q,loading:C.value,disabled:l.value},{default:b(()=>[w(t(C.value?"\u542F\u52A8\u4E2D...":"\u542F\u52A8\u6865\u63A5"),1)]),_:1},8,["loading","disabled"]),p(o,{type:"default",size:"small",onClick:O,loading:F.value,disabled:!l.value},{default:b(()=>[w(t(F.value?"\u505C\u6B62\u4E2D...":"\u505C\u6B62\u6865\u63A5"),1)]),_:1},8,["loading","disabled"]),p(o,{type:"default",size:"small",onClick:$},{default:b(()=>[...e[0]||(e[0]=[w(" \u68C0\u67E5\u72B6\u6001 ",-1)])]),_:1}),l.value?(S(),L("span",fu," \u2705 \u6865\u63A5\u8FD0\u884C\u4E2D (PID: "+t(f.value)+") ",1)):(S(),L("span",Eu," \u23F8\uFE0F \u6865\u63A5\u672A\u8FD0\u884C "))]),r.value?(S(),L("div",Au,[s("p",null,"\u8BBE\u5907IP: "+t(r.value.device_ip)+":"+t(r.value.device_port),1),s("p",null,"\u6865\u63A5\u5730\u5740: "+t(r.value.bridge_url),1),r.value.uptime?(S(),L("p",gu,"\u8FD0\u884C\u65F6\u95F4: "+t(Q(r.value.uptime)),1)):j("",!0)])):j("",!0)]),s("div",pu,[e[3]||(e[3]=s("p",null,"\u{1F50D} \u8C03\u8BD5\u4FE1\u606F:",-1)),s("p",null,"\u8BBE\u5907\u6570\u91CF: "+t(((n=z(y))==null?void 0:n.length)||0),1),s("p",null,"\u76F4\u8FDE\u72B6\u6001: "+t(d.value),1),s("p",null,"\u6700\u540E\u6570\u636E: "+t(h.value),1),s("div",Bu,[p(o,{type:"primary",size:"small",onClick:U,loading:a.value,style:{"margin-right":"8px"}},{default:b(()=>[w(t(a.value?"\u8FDE\u63A5\u4E2D...":"\u8FDE\u63A5\u8BBE\u5907"),1)]),_:1},8,["loading"]),p(o,{type:"default",size:"small",onClick:M,disabled:!1,style:au({background:v.value?"#52c41a":"#d9d9d9",color:"white",border:"none"})},{default:b(()=>[w(t(v.value?"\u624B\u52A8\u67E5\u8BE2 (\u5DF2\u8FDE\u63A5)":"\u624B\u52A8\u67E5\u8BE2 (\u672A\u8FDE\u63A5)"),1)]),_:1},8,["style"]),p(o,{type:"default",size:"small",onClick:N,disabled:!v.value,style:{"margin-left":"8px"}},{default:b(()=>[...e[2]||(e[2]=[w(" \u65AD\u5F00\u8FDE\u63A5 ",-1)])]),_:1},8,["disabled"])])]),p(Y,{loading:x.value,growCardList:z(k)},null,8,["loading","growCardList"]),p(uu,{loading:x.value},null,8,["loading"]),p(Z,{loading:x.value},null,8,["loading"])]}),_:1})}}});export{ne as default};
