var nu=Object.defineProperty,tu=Object.defineProperties;var lu=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var fu=Object.prototype.hasOwnProperty,iu=Object.prototype.propertyIsEnumerable;var O=(f,F,n)=>F in f?nu(f,F,{enumerable:!0,configurable:!0,writable:!0,value:n}):f[F]=n,_=(f,F)=>{for(var n in F||(F={}))fu.call(F,n)&&O(f,n,F[n]);if(N)for(var n of N(F))iu.call(F,n)&&O(f,n,F[n]);return f},S=(f,F)=>tu(f,lu(F));var g=(f,F,n)=>new Promise((P,c)=>{var $=E=>{try{x(n.next(E))}catch(s){c(s)}},p=E=>{try{x(n.throw(E))}catch(s){c(s)}},x=E=>E.done?P(E.value):Promise.resolve(E.value).then($,p);x((n=n.apply(f,F)).next())});import{d as cu,k as H,o as su,b as Eu,U as Du,a1 as i,a2 as h,F as V,ad as R,f as d,a9 as B,a3 as A,a6 as du,a4 as k,E as L,a7 as m,u as t,V as U,B as Bu}from"./vue.2e68d871.js";import{b as vu,af as Cu,I as Au,_ as mu,h as pu}from"./index.69a4dfca.js";/* empty css                *//* empty css                *//* empty css               */import{p as T,r as v,d as D}from"./data.080f0cdf.js";import{c as w}from"./index.cac8beb7.js";import{u as xu}from"./index.3a1d8258.js";import hu from"./DevParam.4701652e.js";import{U as I,b4 as z,b5 as j,aE as q,b6 as gu,b3 as ku}from"./ui.5d3da833.js";import"./utils.93213dc9.js";import"./table.68230543.js";import"./useWindowSizeFn.d3b17bbd.js";import"./useForm.d0703219.js";/* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               */import"./index.e662be6d.js";import"./download.20060076.js";import"./index.8ca31aa0.js";import"./index.35535828.js";const Tu={class:"md:flex flex-wrap"},_u=["title"],Su=["title"],wu=["onClick","title"],Iu={class:"text-gray-500 pr-2"},Pu={class:"text-gray-500 pl-2"},$u={key:0,style:{color:"#999","text-align":"center","margin-top":"20px"}},Wu={style:{"margin-top":"10px"}},Hu=6e4,Lu=cu({__name:"DevBox",props:{loading:{type:Boolean}},setup(f){const{t:F}=vu(),{createMessage:n}=pu(),P=Cu(),c=H(new Map),$=u=>!u||u.length===0?!0:u.every(e=>!e.v||e.v==="-"||e.v===""),p=H(new Map),x=()=>g(this,null,function*(){try{D.value.forEach(u=>{const e=u.id,a=u.serial||"1",o=new WebSocket("ws://127.0.0.1:18900");let r=null;const l=setTimeout(()=>{o.readyState!==WebSocket.OPEN&&(o.close(),c.value.set(e,"server"),r&&(clearInterval(r),r=null),W(e))},Hu);o.onopen=()=>{clearTimeout(l),X(e),c.value.set(e,"direct"),E(o,a),r=setInterval(()=>{E(o,a)},3e3),p.value.set(e,{ws:o,timer:r,failoverTimer:l})},o.onmessage=C=>{C.data instanceof Blob&&C.data.arrayBuffer().then(Fu=>{K(e,Fu)})},o.onerror=C=>{c.value.set(e,"server"),r&&(clearInterval(r),r=null),clearTimeout(l),W(e)},o.onclose=()=>{c.value.set(e,"server"),r&&(clearInterval(r),r=null),clearTimeout(l),p.value.delete(e),W(e)}})}catch(u){}});function E(u,e){if(!(!u||u.readyState!==WebSocket.OPEN))try{const o=`AA${parseInt(e).toString(16).padStart(2,"0").toUpperCase()}0541564B0615`,r=new Uint8Array(o.match(/.{2}/g).map(l=>parseInt(l,16)));u.send(r.buffer)}catch(a){}}const s=H(new Map);function W(u){s.value.has(u)&&clearInterval(s.value.get(u)),M(u);const e=setInterval(()=>{M(u)},3e3);s.value.set(u,e)}function M(u){return g(this,null,function*(){try{const e=yield fetch("/admin/dash");if(e.ok){const a=yield e.json();if(a.code===0&&a.data&&a.data.info){const o=a.data.info.find(r=>r.id===u);o&&G(u,o)}}}catch(e){}})}function G(u,e){const a=D.value.findIndex(r=>r.id===u);if(a===-1)return;const o=S(_({},D.value[a]),{data:e.data||[],time:e.time||new Date().toLocaleTimeString(),warn:e.warn||!1,limit:e.limit||["run","stp","rst"]});D.value.splice(a,1,o)}function X(u){s.value.has(u)&&(clearInterval(s.value.get(u)),s.value.delete(u))}function K(u,e){const a=new Uint8Array(e);if(a.length>=123&&a[0]===85&&a[3]===67&&a[4]===75){const o=Q(a),r=J(o),l=D.value.findIndex(C=>C.id===u);if(l!==-1){const C=S(_({},D.value[l]),{data:r,time:new Date().toLocaleTimeString()});D.value.splice(l,1,C)}}}function Q(u){function e(a,o=100){return(a&32768)!==0?-(~a+1&65535)/o:a/o}return{f01:e(u[5]<<8|u[6]),f02:e(u[7]<<8|u[8]),f03:e(u[9]<<8|u[10]),f04:e(u[11]<<8|u[12]),f05:e(u[13]<<8|u[14]),f06:e(u[15]<<8|u[16]),f07:e(u[17]<<8|u[18]),f08:e(u[19]<<8|u[20]),f09:e(u[21]<<8|u[22]),f10:e(u[23]<<8|u[24]),f11:e(u[25]<<8|u[26]),f12:e(u[27]<<8|u[28]),f13:e(u[29]<<8|u[30]),f14:e(u[31]<<8|u[32]),f15:e(u[33]<<8|u[34]),f16:e(u[35]<<8|u[36]),f17:e(u[37]<<8|u[38]),f18:e(u[39]<<8|u[40]),f19:u[41]<<8|u[42],f20:u[43],f21:u[44],f22:u[45]<<8|u[46],f23:(u[47]<<8|u[48])/10,f24:(u[49]<<8|u[50])/10,f25:(u[51]<<8|u[52])/10,f26:u[53]<<8|u[54],f27:(u[59]<<8|u[60])/10,f28:(u[61]<<8|u[62])/100,f29:e(u[63]<<8|u[64],10),f30:(u[65]<<8|u[66])/10,f31:u[67]<<8|u[68],f32:u[69]<<8|u[70],f33:u[71]<<8|u[72],f34:e(u[73]<<8|u[74],10),f35:e(u[75]<<8|u[76],10),f36:(u[77]<<8|u[78])/10,f37:(u[79]<<8|u[80])/10,f38:(u[81]<<8|u[82])/10,f39:(u[83]<<8|u[84])/10,f40:(u[85]<<8|u[86])/10,f41:(u[87]<<8|u[88])/10,f42:(u[89]<<8|u[90])/10,f43:(u[91]<<8|u[92])/10,f44:(u[93]<<8|u[94])/10,f45:(u[95]<<8|u[96])/10,f46:(u[97]<<8|u[98])/10,f47:(u[99]<<8|u[100])/10,f48:u[101]||0,f49:u[102]||0,f50:u[103]||0,f51:u[104]||0,f52:u[105]||0,f53:u[106]||0,f54:e(u[107]<<8|u[108]),f55:e(u[109]<<8|u[110]),f56:e(u[111]<<8|u[112]),f57:e(u[113]<<8|u[114]),f58:e(u[115]<<8|u[116]),f59:e(u[117]<<8|u[118]),f60:u[119]<<8|u[120]}}function J(u){const e={f01:"\u7CFB\u7EDFA\u76F8\u6709\u529F",f02:"\u7CFB\u7EDFA\u76F8\u65E0\u529F",f03:"\u7CFB\u7EDFA\u76F8\u529F\u7387\u56E0\u6570",f04:"\u7CFB\u7EDFB\u76F8\u6709\u529F",f05:"\u7CFB\u7EDFB\u76F8\u65E0\u529F",f06:"\u7CFB\u7EDFB\u76F8\u529F\u7387\u56E0\u6570",f07:"\u7CFB\u7EDFC\u76F8\u6709\u529F",f08:"\u7CFB\u7EDFC\u76F8\u65E0\u529F",f09:"\u7CFB\u7EDFC\u76F8\u529F\u7387\u56E0\u6570",f10:"\u8F93\u51FAA\u76F8\u6709\u529F",f11:"\u8F93\u51FAA\u76F8\u65E0\u529F",f12:"\u8F93\u51FAA\u76F8\u529F\u7387\u56E0\u6570",f13:"\u8F93\u51FAB\u76F8\u6709\u529F",f14:"\u8F93\u51FAB\u76F8\u65E0\u529F",f15:"\u8F93\u51FAB\u76F8\u529F\u7387\u56E0\u6570",f16:"\u8F93\u51FAC\u76F8\u6709\u529F",f17:"\u8F93\u51FAC\u76F8\u65E0\u529F",f18:"\u8F93\u51FAC\u76F8\u529F\u7387\u56E0\u6570",f19:"FPGA\u7248\u672C\u53F7",f20:"\u72B6\u6001",f21:"\u9884\u7559",f22:"DSPB\u7248\u672C\u53F7",f23:"A\u76F8\u7535\u7F51\u7535\u538B",f24:"B\u76F8\u7535\u7F51\u7535\u538B",f25:"C\u76F8\u7535\u7F51\u7535\u538B",f26:"DSPA\u7248\u672C\u53F7",f27:"\u7535\u7F51\u7535\u6D41\u4E0D\u5E73\u8861\u5EA6",f28:"\u7535\u7F51\u9891\u7387",f29:"A\u76F8\u6E29\u5EA6",f30:"\u7535\u7F51\u7535\u538B\u4E0D\u5E73\u8861\u5EA6",f31:"\u76F4\u6D41\u6BCD\u7EBF\u7535\u538B",f32:"\u4E0A\u5206\u88C2\u7535\u5BB9\u7535\u538B",f33:"\u4E0B\u5206\u88C2\u7535\u5BB9\u7535\u538B",f34:"B\u76F8\u6E29\u5EA6",f35:"C\u76F8\u6E29\u5EA6",f36:"A\u76F8\u88C5\u7F6E\u7535\u6D41",f37:"B\u76F8\u88C5\u7F6E\u7535\u6D41",f38:"C\u76F8\u88C5\u7F6E\u7535\u6D41",f39:"A\u76F8\u8D1F\u8F7D\u7535\u6D41",f40:"B\u76F8\u8D1F\u8F7D\u7535\u6D41",f41:"C\u76F8\u8D1F\u8F7D\u7535\u6D41",f42:"A\u76F8\u7F51\u4FA7\u7535\u6D41",f43:"B\u76F8\u7F51\u4FA7\u7535\u6D41",f44:"C\u76F8\u7F51\u4FA7\u7535\u6D41",f45:"A\u76F8\u8BBE\u5907\u7535\u6D41",f46:"B\u76F8\u8BBE\u5907\u7535\u6D41",f47:"C\u76F8\u8BBE\u5907\u7535\u6D41",f48:"\u6545\u969C\u4FE1\u606F5",f49:"\u6545\u969C\u4FE1\u606F4",f50:"\u6545\u969C\u4FE1\u606F3",f51:"\u6545\u969C\u4FE1\u606F2",f52:"EXTSTATE0",f53:"EXTSTATE2",f54:"\u8D1F\u8F7DA\u76F8\u6709\u529F",f55:"\u8D1F\u8F7DA\u76F8\u65E0\u529F",f56:"\u8D1F\u8F7DB\u76F8\u6709\u529F",f57:"\u8D1F\u8F7DB\u76F8\u65E0\u529F",f58:"\u8D1F\u8F7DC\u76F8\u6709\u529F",f59:"\u8D1F\u8F7DC\u76F8\u65E0\u529F",f60:"\u5DE5\u4F5C\u6A21\u5F0F"},a={f01:"kW",f02:"kvar",f04:"kW",f05:"kvar",f07:"kW",f08:"kvar",f10:"kW",f11:"kvar",f13:"kW",f14:"kvar",f16:"kW",f17:"kvar",f23:"V",f24:"V",f25:"V",f27:"%",f28:"Hz",f29:"\u2103",f30:"%",f31:"V",f32:"V",f33:"V",f34:"\u2103",f35:"\u2103",f36:"A",f37:"A",f38:"A",f39:"A",f40:"A",f41:"A",f42:"A",f43:"A",f44:"A",f45:"A",f46:"A",f47:"A",f54:"kW",f55:"kvar",f56:"kW",f57:"kvar",f58:"kW",f59:"kvar"},o=[];return Object.keys(u).forEach(r=>{if(r.startsWith("f")){const l=typeof u[r]=="number"?u[r].toFixed(2):u[r];o.push({k:e[r]||r,v:l,u:a[r]||""})}}),o}function Y(u){T(),w({id:u.id,mode:"run"}).then(()=>{n.success(F("routes.dashboard.dash.cmdSuccess")),setTimeout(()=>{v()},2e3)}).catch(e=>{n.error("\u542F\u52A8\u547D\u4EE4\u5931\u8D25: "+(e.message||"\u670D\u52A1\u5668\u5F02\u5E38")),setTimeout(()=>{v()},2e3)})}function Z(u){T(),w({id:u.id,mode:"stp"}).then(e=>{n.success(F("routes.dashboard.dash.cmdSuccess")),setTimeout(()=>{v()},2e3)}).catch(e=>{n.error("\u505C\u6B62\u547D\u4EE4\u5931\u8D25: "+(e.message||"\u670D\u52A1\u5668\u5F02\u5E38")),setTimeout(()=>{v()},2e3)})}function y(u){T(),w({id:u.id,mode:"rst"}).then(()=>{n.success(F("routes.dashboard.dash.cmdSuccess")),setTimeout(()=>{v()},2e3)}).catch(e=>{n.error("\u590D\u4F4D\u547D\u4EE4\u5931\u8D25: "+(e.message||"\u670D\u52A1\u5668\u5F02\u5E38")),setTimeout(()=>{v()},2e3)})}const[b,{openModal:uu}]=xu();function eu(u){uu(!0,{record:u})}function ou(u){const{values:e}=u;w(S(_({},e),{mode:"pam"})).then(()=>{n.success(F("routes.dashboard.dash.cmdSuccess"))})}function ru(u){if(!u.id){n.warning(F("routes.dashboard.dash.noDeviceId"));return}n.info(F("routes.dashboard.dash.jumpToSettings")),setTimeout(()=>{P(`/dev/index?openDeviceId=${u.id}&openParam=true`)},300)}su(()=>g(this,null,function*(){try{if(yield au()){T();const a=()=>{D.value&&D.value.length>0?x():setTimeout(a,1e3)};setTimeout(a,2e3)}else v()}catch(e){}}));function au(){return g(this,null,function*(){return new Promise(u=>{try{const e=new WebSocket("ws://127.0.0.1:18900"),a=setTimeout(()=>{e.close(),u(!1)},2e3);e.onopen=()=>{clearTimeout(a),e.close(),u(!0)},e.onerror=()=>{clearTimeout(a),u(!1)}}catch(e){u(!1)}})})}return Eu(()=>{p.value.forEach((u,e)=>{u.timer&&clearInterval(u.timer),u.failoverTimer&&clearTimeout(u.failoverTimer),u.ws&&u.ws.readyState===WebSocket.OPEN&&u.ws.close()}),p.value.clear(),s.value.forEach((u,e)=>{clearInterval(u)}),s.value.clear()}),(u,e)=>{const a=Du("a-button");return i(),h("div",Tu,[(i(!0),h(V,null,R(t(D),o=>(i(),h("div",{key:o.id,class:"md:w-1/4 w-full !md:mt-0"},[d(t(ku),{size:"small",loading:f.loading,title:o.name||`\u8BBE\u5907${o.id}`,bodyStyle:{maxHeight:"400px"},class:"!m-2"},{extra:B(()=>[A("span",{style:du({display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:c.value.get(o.id)==="direct"?"#52c41a":"#1890ff",marginRight:"6px",boxShadow:c.value.get(o.id)==="direct"?"0 0 4px #52c41a":"0 0 4px #1890ff"}),title:c.value.get(o.id)==="direct"?"\u76F4\u8FDE\u6A21\u5F0F":"\u670D\u52A1\u5668\u6A21\u5F0F"},null,12,_u),A("span",{title:c.value.get(o.id)==="direct"?"\u76F4\u8FDE\u6A21\u5F0F":"\u670D\u52A1\u5668\u6A21\u5F0F",style:{"margin-right":"8px","font-size":"12px",color:"#666"}},k(c.value.get(o.id)==="direct"?"\u76F4\u8FDE":"\u670D\u52A1\u5668"),9,Su),L(" "+k(o.time)+" ",1),o.warn?(i(),m(t(Au),{key:0,icon:"warning|svg",size:20,style:{"margin-left":"4px"}})):U("",!0)]),actions:B(()=>[d(t(I),{title:t(F)("routes.dashboard.dash.start")},{default:B(()=>{var r;return[(r=o.limit)!=null&&r.includes("run")?(i(),m(t(z),{key:0,style:{color:"#0000003f"}})):(i(),m(t(z),{key:"on",onClick:l=>Y(o)},null,8,["onClick"]))]}),_:2},1032,["title"]),d(t(I),{title:t(F)("routes.dashboard.dash.stop")},{default:B(()=>{var r;return[(r=o.limit)!=null&&r.includes("stp")?(i(),m(t(j),{key:0,style:{color:"#0000003f"}})):(i(),m(t(j),{key:"off",onClick:l=>Z(o)},null,8,["onClick"]))]}),_:2},1032,["title"]),d(t(I),{title:t(F)("routes.dashboard.dash.reset")},{default:B(()=>{var r;return[(r=o.limit)!=null&&r.includes("rst")?(i(),m(t(q),{key:0,style:{color:"#0000003f"}})):(i(),m(t(q),{key:"reset",onClick:l=>y(o)},null,8,["onClick"]))]}),_:2},1032,["title"]),d(t(I),{title:t(F)("routes.dashboard.dash.param")},{default:B(()=>[d(t(gu),{key:"param",onClick:r=>eu(o)},null,8,["onClick"])]),_:2},1032,["title"])]),default:B(()=>[A("div",{class:"px-4 min-h-72 overflow-auto max-h-[360px] param-display-area",onClick:r=>ru(o),title:t(F)("routes.dashboard.dash.clickToSettings")},[(i(!0),h(V,null,R(o.data,(r,l)=>(i(),h("div",{class:"flex",key:l},[A("div",Iu,k(r.k)+":",1),A("div",null,k(r.v),1),A("div",Pu,k(r.u),1)]))),128)),!o.data||o.data.length===0||$(o.data)?(i(),h("div",$u,[e[1]||(e[1]=L(" \u6682\u65E0\u6570\u636E ",-1)),A("div",Wu,[d(a,{size:"small",onClick:Bu(x,["stop"]),type:"link"},{default:B(()=>[...e[0]||(e[0]=[L(" \u8BBE\u7F6E\u76F4\u8FDE ",-1)])]),_:1})])])):U("",!0)],8,wu)]),_:2},1032,["loading","title"])]))),128)),d(hu,{onRegister:t(b),onSuccess:ou},null,8,["onRegister"])])}}});var le=mu(Lu,[["__scopeId","data-v-9b0a9ba0"]]);export{le as default};
