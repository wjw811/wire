var Fa=Object.defineProperty,Da=Object.defineProperties;var Ba=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var wa=Object.prototype.hasOwnProperty,ka=Object.prototype.propertyIsEnumerable;var we=(D,u,i)=>u in D?Fa(D,u,{enumerable:!0,configurable:!0,writable:!0,value:i}):D[u]=i,V=(D,u)=>{for(var i in u||(u={}))wa.call(u,i)&&we(D,i,u[i]);if(Be)for(var i of Be(u))ka.call(u,i)&&we(D,i,u[i]);return D},ke=(D,u)=>Da(D,Ba(u));var E=(D,u,i)=>new Promise((O,q)=>{var t=h=>{try{T(i.next(h))}catch(H){q(H)}},ae=h=>{try{T(i.throw(h))}catch(H){q(H)}},T=h=>h.done?O(h.value):Promise.resolve(h.value).then(t,ae);T((i=i.apply(D,u)).next())});import{d as xa,k as x,e as J,n as d,w as Pa,q as Q,b as Sa,U as Aa,a1 as k,a2 as xe,f as p,a9 as f,u as s,a3 as y,a7 as A,a4 as w,F as Pe,ad as qa,E as R,t as re,A as ie,a8 as Ia}from"./vue.2e68d871.js";import{a8 as m,T as Se,b2 as Ra,b9 as X,U as Y,b4 as Ae,b5 as qe,aE as Ie,aX as za,ba as Oa,aK as Na,bb as Va,bc as Qa,bd as Ta,_ as Ha}from"./ui.5d3da833.js";import{b as Ma,aU as ne,_ as Wa,h as $a}from"./index.69a4dfca.js";/* empty css                */import{u as Re,D as ze}from"./index.3e1895a9.js";import{j as G,B as j}from"./useForm.d0703219.js";/* empty css               */import{a as Ga,B as ja}from"./index.0675591f.js";import{u as Ua}from"./index.3a1d8258.js";import{i as La,h as Ka}from"./index.35535828.js";import{u as Oe,B as Ne}from"./useTable.7df14f41.js";import{i as Ja,b as Xa,w as Ya}from"./index.data.ff8161d5.js";import{c as z,s as ce,b as Z,a as ee,d as de}from"./index.cac8beb7.js";import Za from"./chart.94afd00b.js";import"./utils.93213dc9.js";import"./table.68230543.js";/* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               */import"./index.e662be6d.js";import"./download.20060076.js";import"./index.8ca31aa0.js";/* empty css                */import"./useWindowSizeFn.d3b17bbd.js";import"./index.bff03604.js";/* empty css                *//* empty css                */import"./useContentViewHeight.d0ccb353.js";import"./sortable.esm.e8ee5a53.js";/* empty css               */import"./gateway.2a62e783.js";import"./data.71aa74fd.js";import"./useECharts.4e74db27.js";import"./charts.e5d90eae.js";const eu={class:"flex gap-5"},au={class:"flex items-center gap-4"},uu={class:"text-sm border-b border-[#d9d9d9] flex items-center"},su={class:"py-3 pl-4"},tu={class:"px-3 text-xs font-normal text-gray-400"},lu={class:"text-gray-400"},ou={class:"flex"},ru={class:"p-2"},iu={class:"flex justify-end mb-4"},nu={class:"param-form-container"},cu={class:"mt-4 text-right space-x-2"},du={class:"param-form-container"},mu={class:"param-form-container"},pu={class:"mt-4 text-right space-x-2"},vu={class:"param-form-container"},hu={class:"mt-4 text-right space-x-2"},fu=xa({__name:"info",setup(D){const{t:u}=Ma(),{createMessage:i}=$a(),O=x({}),q=x("1"),t=x({batchQueryCompAuto:!1,batchSaveCompAuto:!1,batchQueryOtherParams:!1,batchSaveOtherParams:!1,batchQueryHarmParams:!1,batchSaveHarmParams:!1,reload:!1}),[ae,{setDrawerProps:T}]=Ga(e=>E(this,null,function*(){h.value=[],ue.value=[],oe.value=[],O.value=e==null?void 0:e.record,T({confirmLoading:!1,title:u("dev.info.title")+"-"+e.record.name}),_e(),(e==null?void 0:e.openParam)===!0?q.value="4":q.value="1"})),h=x({}),[H]=Re({title:u("dev.info.title"),data:h,column:1,schema:Ja}),ue=x([]),[Ve]=Re({title:u("dev.info.recentWarn"),data:ue,column:1,schema:Xa}),se=J(()=>{var n,o;const e=((n=h.value)==null?void 0:n.feature)||[],a=((o=h.value)==null?void 0:o.history)||{};return e.map(l=>ke(V({},l),{val:(a==null?void 0:a.content[l.key])!==void 0?a==null?void 0:a.content[l.key]:"-"}))}),Qe=J(()=>{var a;return(((a=h.value)==null?void 0:a.history)||{}).created}),te=J(()=>{var a,n;return((n=(((a=h.value)==null?void 0:a.history)||{}).content)==null?void 0:n.limit)||["run","stp","rst"]}),M=x(1);function Te(e){M.value=e}const me=[{label:u("routes.dashboard.dash.disable"),value:0},{label:u("routes.dashboard.dash.enable"),value:1}],He=[{label:u("routes.dashboard.dash.outflow"),value:0},{label:u("routes.dashboard.dash.inflow"),value:1}],Me=[{label:u("routes.dashboard.dash.outflow"),value:0},{label:u("routes.dashboard.dash.inflow"),value:1}],We=[{label:u("routes.dashboard.dash.cabinet"),value:0},{label:u("routes.dashboard.dash.capacitor"),value:1}],$e=[{label:u("routes.dashboard.dash.cabinet"),value:0},{label:u("routes.dashboard.dash.capacitor"),value:1}];function I(e,a){if(a==null||a==="")return Promise.resolve();const n=Number(a);return Number.isNaN(n)?Promise.reject(u("routes.dashboard.dash.inputNumber")):n===0||n>=2&&n<=50?Promise.resolve():Promise.reject(u("routes.dashboard.dash.allowRange"))}const le=[{field:"auto_enable",label:u("routes.dashboard.dash.autoEnable"),component:"Select",componentProps:{options:me}},{field:"comp_mode",label:u("routes.dashboard.dash.compMode"),component:"Select",componentProps:{options:[{label:"1 \u4E0D\u5E73\u8861\u8861",value:1},{label:"2 \u65E0\u529F\u529F\u8865\u507F",value:2},{label:"4 \u8C10\u6CE2\u7EC4",value:4},{label:"6 \u65E0\u529F\u529F+\u8C10\u6CE2\u7EC4\u8865\u507F",value:6},{label:"13 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:13},{label:"14 \u8C10\u6CE2\u7EC4+\u65E0\u529F\u529F\u8865\u507F",value:14},{label:"15 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u65E0\u529F\u529F\u8865\u507F",value:15},{label:"16 \u81EA\u8001\u5316\u53D1\u65E0\u529F\u529F",value:16},{label:"35 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:35},{label:"39 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8C10\u6CE2\u7EC4\u8865\u507F",value:39}]}},{field:"in_sample_pos",label:u("routes.dashboard.dash.inSamplePos"),component:"Select",componentProps:{options:We},suffix:()=>{var e;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:!1,onClick:()=>g("in_sample_pos",17)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((e=t.value.in_sample_pos)==null?void 0:e.save)||!1,onClick:()=>C("in_sample_pos",17)},()=>u("sys.util.save"))])}},{field:"in_sample_dir",label:u("routes.dashboard.dash.inSampleDir"),component:"Select",componentProps:{options:He},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.in_sample_dir)==null?void 0:e.query)||!1,onClick:()=>g("in_sample_dir",15)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.in_sample_dir)==null?void 0:a.save)||!1,onClick:()=>C("in_sample_dir",15)},()=>u("sys.util.save"))])}},{field:"in_ct_ratio",label:u("routes.dashboard.dash.inCtRatio"),component:"InputNumber",componentProps:{min:1,max:1e4,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.in_ct_ratio)==null?void 0:e.query)||!1,onClick:()=>g("in_ct_ratio",241)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.in_ct_ratio)==null?void 0:a.save)||!1,onClick:()=>C("in_ct_ratio",241)},()=>u("sys.util.save"))])}},{field:"dev_sample_enable",label:u("routes.dashboard.dash.devSampleEnable"),component:"Select",componentProps:{options:me},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.dev_sample_enable)==null?void 0:e.query)||!1,onClick:()=>g("dev_sample_enable",16)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.dev_sample_enable)==null?void 0:a.save)||!1,onClick:()=>C("dev_sample_enable",16)},()=>u("sys.util.save"))])}},{field:"dev_sample_pos",label:u("routes.dashboard.dash.devSamplePos"),component:"Select",componentProps:{options:$e},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.dev_sample_pos)==null?void 0:e.query)||!1,onClick:()=>g("dev_sample_pos",13)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.dev_sample_pos)==null?void 0:a.save)||!1,onClick:()=>C("dev_sample_pos",13)},()=>u("sys.util.save"))])}},{field:"dev_sample_dir",label:u("routes.dashboard.dash.devSampleDir"),component:"Select",componentProps:{options:Me},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.dev_sample_dir)==null?void 0:e.query)||!1,onClick:()=>g("dev_sample_dir",14)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.dev_sample_dir)==null?void 0:a.save)||!1,onClick:()=>C("dev_sample_dir",14)},()=>u("sys.util.save"))])}},{field:"dev_ct_ratio",label:u("routes.dashboard.dash.devCtRatio"),component:"InputNumber",componentProps:{min:1,max:1e4,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.dev_ct_ratio)==null?void 0:e.query)||!1,onClick:()=>g("dev_ct_ratio",242)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.dev_ct_ratio)==null?void 0:a.save)||!1,onClick:()=>C("dev_ct_ratio",242)},()=>u("sys.util.save"))])}},{field:"harm_group1",label:u("routes.dashboard.dash.harmGroup",[1]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group1)==null?void 0:e.query)||!1,onClick:()=>g("harm_group1",265)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group1)==null?void 0:a.save)||!1,onClick:()=>C("harm_group1",265)},()=>u("sys.util.save"))])}},{field:"harm_group2",label:u("routes.dashboard.dash.harmGroup",[2]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group2)==null?void 0:e.query)||!1,onClick:()=>g("harm_group2",266)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group2)==null?void 0:a.save)||!1,onClick:()=>C("harm_group2",266)},()=>u("sys.util.save"))])}},{field:"harm_group3",label:u("routes.dashboard.dash.harmGroup",[3]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group3)==null?void 0:e.query)||!1,onClick:()=>g("harm_group3",267)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group3)==null?void 0:a.save)||!1,onClick:()=>C("harm_group3",267)},()=>u("sys.util.save"))])}},{field:"harm_group4",label:u("routes.dashboard.dash.harmGroup",[4]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group4)==null?void 0:e.query)||!1,onClick:()=>g("harm_group4",268)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group4)==null?void 0:a.save)||!1,onClick:()=>C("harm_group4",268)},()=>u("sys.util.save"))])}},{field:"harm_group5",label:u("routes.dashboard.dash.harmGroup",[5]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group5)==null?void 0:e.query)||!1,onClick:()=>g("harm_group5",269)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group5)==null?void 0:a.save)||!1,onClick:()=>C("harm_group5",269)},()=>u("sys.util.save"))])}},{field:"harm_group6",label:u("routes.dashboard.dash.harmGroup",[6]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group6)==null?void 0:e.query)||!1,onClick:()=>g("harm_group6",270)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group6)==null?void 0:a.save)||!1,onClick:()=>C("harm_group6",270)},()=>u("sys.util.save"))])}},{field:"harm_group7",label:u("routes.dashboard.dash.harmGroup",[7]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group7)==null?void 0:e.query)||!1,onClick:()=>g("harm_group7",271)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group7)==null?void 0:a.save)||!1,onClick:()=>C("harm_group7",271)},()=>u("sys.util.save"))])}},{field:"harm_group8",label:u("routes.dashboard.dash.harmGroup",[8]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group8)==null?void 0:e.query)||!1,onClick:()=>g("harm_group8",272)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group8)==null?void 0:a.save)||!1,onClick:()=>C("harm_group8",272)},()=>u("sys.util.save"))])}}],Ge=["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"],je=["in_sample_pos","in_sample_dir","in_ct_ratio"],[Ue,{setFieldsValue:U,validate:Le,getFieldsValue:pe}]=G({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:le.filter(e=>Ge.includes(e.field))}),[Ke,{setFieldsValue:L,validate:Je,getFieldsValue:ve}]=G({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:le.filter(e=>je.includes(e.field))}),[Xe,{setFieldsValue:K,getFieldsValue:he,validate:Ye}]=G({labelWidth:220,baseColProps:{span:12},showActionButtonGroup:!1,schemas:le.filter(e=>e.field&&e.field.startsWith("harm_group"))}),fe=x(!1);function _e(){var e;La({id:(e=O.value)==null?void 0:e.id}).then(a=>{var n;h.value=a.base,ue.value=((n=a.base)==null?void 0:n.warn)||{},oe.value=a.warn,U({}),L({}),K({}),W({comp_mode:void 0}),$({auto_enable:void 0})})}function Ze(){return E(this,null,function*(){var a;if(fe.value)return;fe.value=!0;const e=(a=h.value)==null?void 0:a.id;if(!!e)try{yield z({id:e,cmd:513,mode:"syn"}),yield new Promise(l=>setTimeout(l,1e3));const n=yield ce({id:e});if((n==null?void 0:n.val)!==void 0&&n.val!==null){yield Q(),yield new Promise(l=>setTimeout(l,200));try{W({comp_mode:Number(n.val)})}catch(l){}}yield z({id:e,cmd:512,mode:"syn"}),yield new Promise(l=>setTimeout(l,1e3));const o=yield ce({id:e});if((o==null?void 0:o.val)!==void 0&&o.val!==null){yield Q(),yield new Promise(l=>setTimeout(l,200));try{$({auto_enable:Number(o.val)})}catch(l){}}}catch(n){}})}Pa(()=>q.value,e=>E(this,null,function*(){String(e)==="4"?(ne(!0),yield Q(),yield new Promise(a=>setTimeout(a,500)),yield Ze()):ne(!1)})),Sa(()=>ne(!1));const be=x(!1);function ye(){t.value.reload=!0,be.value=!0,setTimeout(()=>{be.value=!1,t.value.reload=!1},2e3),_e()}function ea(){const e=h.value;z({id:e.id,mode:"run"}).then(()=>{i.success(u("routes.dashboard.dash.cmdSuccess"))})}function aa(){const e=h.value;z({id:e.id,mode:"stp"}).then(()=>{i.success(u("routes.dashboard.dash.cmdSuccess"))})}function ua(){const e=h.value;z({id:e.id,mode:"rst"}).then(()=>{i.success(u("routes.dashboard.dash.cmdSuccess"))})}function ge(e,a=3,n=200){return E(this,null,function*(){for(let o=0;o<a;o++){yield new Promise(c=>setTimeout(c,n));const l=yield ce({id:e});if((l==null?void 0:l.val)!==void 0&&l.val!==null)return l}return null})}function sa(){Ce()}function Ce(){return E(this,null,function*(){var a,n;const e=(a=h.value)==null?void 0:a.id;if(!!e){t.value.batchQueryCompAuto=!0;try{const o=yield Z({id:e,startAddr:512,count:2});if(!o||!o.taskId){i.error("\u63D0\u4EA4\u67E5\u8BE2\u5931\u8D25");return}const l=o.taskId;for(let c=0;c<10;c++){yield new Promise(v=>setTimeout(v,200));const r=yield ee({taskId:l});if(r.status==="completed"){const v=r.result,B=((n=v==null?void 0:v.data)==null?void 0:n.values)||(v==null?void 0:v.data)||(v==null?void 0:v.values)||v;if(B&&Array.isArray(B)&&B.length>=2){yield Q();try{const F=Number(B[0]);let _=Number(B[1]);if(_>128){const b=_&255;(b&240)===128&&(_=_&65280|b&15)}$({auto_enable:F}),W({comp_mode:_}),setTimeout(()=>{const b=document.querySelector('[codefield="auto_enable"]'),P=document.querySelector('[codefield="comp_mode"]');if(b){b.setAttribute("formvalues",JSON.stringify({auto_enable:F}));const S=b.querySelector(".ant-select-selection-placeholder");S&&(S.textContent=F===1?"\u4F7F\u80FD":"\u4E0D\u4F7F\u80FD",S.style.color="#000")}if(P){P.setAttribute("formvalues",JSON.stringify({comp_mode:_}));const S=P.querySelector(".ant-select-selection-placeholder");S&&(S.textContent=_+" \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u65E0\u529F\u8865\u507F",S.style.color="#000")}},100),i.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}catch(F){i.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}}else i.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F");return}else if(r.status==="failed"){i.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25: "+(r.error||"\u672A\u77E5\u9519\u8BEF"));return}}i.warning("\u67E5\u8BE2\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5")}catch(o){i.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25")}finally{t.value.batchQueryCompAuto=!1}}})}function ta(){return E(this,null,function*(){var o,l,c;yield Promise.all([ba(),Ca()]);const e=(o=Fe())==null?void 0:o.comp_mode,a=(l=De())==null?void 0:l.auto_enable,n=(c=h.value)==null?void 0:c.id;if(!!n){t.value.batchSaveCompAuto=!0;try{const r=[];a!=null&&a!==""&&r.push({addr:512,val:a}),e!=null&&e!==""&&r.push({addr:513,val:e}),r.length>0?(yield de({id:n,data:r,mode:"batch_save"}),yield new Promise(v=>setTimeout(v,800)),yield Ce(),i.success("\u6279\u91CF\u4FDD\u5B58\u6210\u529F\uFF0C\u5DF2\u81EA\u52A8\u8BFB\u53D6\u8BBE\u5907\u54CD\u5E94")):i.warning("\u6CA1\u6709\u9700\u8981\u4FDD\u5B58\u7684\u6570\u636E")}catch(r){i.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25")}finally{t.value.batchSaveCompAuto=!1}}})}function g(e,a){return E(this,null,function*(){var o;const n=(o=h.value)==null?void 0:o.id;if(!!n){t.value[e]||(t.value[e]={query:!1,save:!1}),t.value[e].query=!0;try{yield z({id:n,cmd:a,mode:"syn"});const l=yield ge(n,10,200);if(l){let c=l.val;["in_ct_ratio","dev_ct_ratio"].includes(e)&&(c=c/10),yield Q();try{if(["comp_mode"].includes(e))W({[e]:c});else if(["auto_enable"].includes(e))$({[e]:c});else if(["in_sample_pos","in_sample_dir","in_ct_ratio"].includes(e))L({[e]:c});else if(["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"].includes(e))U({[e]:c});else if(e.startsWith("harm_group")){const r=typeof c=="string"&&c.includes(",")?c.split(",").map(Number):Number(c);K({[e]:r})}}catch(r){}}i.success(u("sys.util.querySuccess"))}catch(l){i.error(u("sys.util.queryFail"))}finally{t.value[e].query=!1}}})}function C(e,a){return E(this,null,function*(){var o;const n=(o=h.value)==null?void 0:o.id;if(!n){i.error("\u8BBE\u5907ID\u672A\u627E\u5230");return}t.value[e]||(t.value[e]={query:!1,save:!1}),t.value[e].save=!0;try{let l;if(["comp_mode"].includes(e)?l=Fe()[e]:["auto_enable"].includes(e)?l=De()[e]:["in_sample_pos","in_sample_dir","in_ct_ratio"].includes(e)?l=ve()[e]:["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"].includes(e)?l=pe()[e]:e.startsWith("harm_group")&&(l=he()[e]),l==null||l===""){i.error("\u8BF7\u5148\u8BBE\u7F6E\u53C2\u6570");return}["in_ct_ratio","dev_ct_ratio"].includes(e)&&(l=Math.round(Number(l)*10)),e.startsWith("harm_group")&&(l=Array.isArray(l)?l.join(","):l),e.startsWith("harm_group")||(l=Math.round(Number(l))),yield z({id:n,cmd:a,val:l,mode:"pam"}),yield new Promise(r=>setTimeout(r,500)),yield z({id:n,cmd:a,mode:"syn"});const c=yield ge(n,10,200);if(c&&c.val!==void 0&&c.val!==null){let r=c.val;["in_ct_ratio","dev_ct_ratio"].includes(e)&&(r=r/10),yield Q();try{if(["comp_mode"].includes(e))W({[e]:r});else if(["auto_enable"].includes(e))$({[e]:r});else if(["in_sample_pos","in_sample_dir","in_ct_ratio"].includes(e))L({[e]:r});else if(["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"].includes(e))U({[e]:r});else if(e.startsWith("harm_group")){const v=typeof r=="string"&&r.includes(",")?r.split(",").map(Number):Number(r);K({[e]:v})}i.success(`\u4FDD\u5B58\u6210\u529F\uFF0C\u8BBE\u5907\u54CD\u5E94\u503C: ${r}`)}catch(v){i.success("\u4FDD\u5B58\u6210\u529F")}}else i.success("\u4FDD\u5B58\u6210\u529F\uFF08\u672A\u6536\u5230\u8BBE\u5907\u54CD\u5E94\uFF0C\u8BF7\u624B\u52A8\u67E5\u8BE2\u9A8C\u8BC1\uFF09")}catch(l){i.error(`\u4FDD\u5B58\u5931\u8D25: ${l.message||l}`)}finally{t.value[e].save=!1}})}function la(){return E(this,null,function*(){var a,n,o;const e=(a=h.value)==null?void 0:a.id;if(!!e){t.value.batchQueryOtherParams=!0;try{const l=yield Z({id:e,startAddr:13,count:5});if(!l||!l.taskId){i.error("\u63D0\u4EA4\u67E5\u8BE21\u5931\u8D25");return}const c=l.taskId;let r=null;for(let _=0;_<15;_++){yield new Promise(P=>setTimeout(P,500));const b=yield ee({taskId:c});if(b.status==="completed"){r=b.result;break}else if(b.status==="failed"){i.error("\u67E5\u8BE21\u5931\u8D25");return}}if(!r){i.warning("\u67E5\u8BE21\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}const v=yield Z({id:e,startAddr:241,count:2});if(!v||!v.taskId){i.error("\u63D0\u4EA4\u67E5\u8BE22\u5931\u8D25");return}const B=v.taskId;let F=null;for(let _=0;_<15;_++){yield new Promise(P=>setTimeout(P,500));const b=yield ee({taskId:B});if(b.status==="completed"){F=b.result;break}else if(b.status==="failed"){i.error("\u67E5\u8BE22\u5931\u8D25");return}}if(!F){i.warning("\u67E5\u8BE22\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}if(r&&r.data&&F&&F.data){const _=((n=r.data)==null?void 0:n.values)||r.data,b=((o=F.data)==null?void 0:o.values)||F.data;if(_.length>=5&&b.length>=2){const P={dev_sample_pos:_[0],dev_sample_dir:_[1],dev_sample_enable:_[3],dev_ct_ratio:b[1]/10},S={in_sample_dir:_[2],in_sample_pos:_[4],in_ct_ratio:b[0]/10};U(P),L(S)}}i.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}catch(l){i.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25")}finally{t.value.batchQueryOtherParams=!1}}})}function oa(){return E(this,null,function*(){var n;yield Promise.all([Le(),Je()]);const e=V(V({},pe()),ve()),a=(n=h.value)==null?void 0:n.id;if(!!a){t.value.batchSaveOtherParams=!0;try{const o=[],l={dev_sample_pos:{addr:13},dev_sample_dir:{addr:14},in_sample_dir:{addr:15},dev_sample_enable:{addr:16},in_sample_pos:{addr:17},in_ct_ratio:{addr:241,scale:c=>Math.round(Number(c)*10)},dev_ct_ratio:{addr:242,scale:c=>Math.round(Number(c)*10)}};for(const[c,r]of Object.entries(l))if(c in e&&e[c]!==void 0&&e[c]!==null&&e[c]!==""){const v=r.scale?r.scale(e[c]):e[c];o.push({addr:r.addr,val:v})}o.length>0?(yield de({id:a,data:o,mode:"batch_save"}),i.success("\u6279\u91CF\u4FDD\u5B58\u6210\u529F")):i.warning("\u6CA1\u6709\u9700\u8981\u4FDD\u5B58\u7684\u6570\u636E")}catch(o){i.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25")}finally{t.value.batchSaveOtherParams=!1}}})}function ra(){return E(this,null,function*(){var a,n;const e=(a=h.value)==null?void 0:a.id;if(!!e){t.value.batchQueryHarmParams=!0;try{const o=yield Z({id:e,startAddr:265,count:8});if(!o||!o.taskId){i.error("\u63D0\u4EA4\u67E5\u8BE2\u5931\u8D25");return}const l=o.taskId;let c=null;for(let r=0;r<20;r++){yield new Promise(B=>setTimeout(B,500));const v=yield ee({taskId:l});if(v.status==="completed"){c=v.result;break}else if(v.status==="failed"){i.error("\u67E5\u8BE2\u5931\u8D25");return}}if(!c){i.warning("\u67E5\u8BE2\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}if(c&&c.data){const r=((n=c.data)==null?void 0:n.values)||c.data;if(r.length>=8){const v={harm_group1:r[0],harm_group2:r[1],harm_group3:r[2],harm_group4:r[3],harm_group5:r[4],harm_group6:r[5],harm_group7:r[6],harm_group8:r[7]};K(v);const B=[],F=["\u8C10\u6CE2\u7EC41(265)","\u8C10\u6CE2\u7EC42(266)","\u8C10\u6CE2\u7EC43(267)","\u8C10\u6CE2\u7EC44(268)","\u8C10\u6CE2\u7EC45(269)","\u8C10\u6CE2\u7EC46(270)","\u8C10\u6CE2\u7EC47(271)","\u8C10\u6CE2\u7EC48(272)"];r.forEach((_,b)=>{B.push(`${F[b]}: ${_}`)}),i.success(`\u6279\u91CF\u67E5\u8BE2\u6210\u529F\uFF01\u8C10\u6CE2\u7EC4\u53C2\u6570\u503C\uFF1A${B.join(", ")}`)}}else i.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}catch(o){i.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25")}finally{t.value.batchQueryHarmParams=!1}}})}function ia(){return E(this,null,function*(){var n;yield Ye();const e=he(),a=(n=h.value)==null?void 0:n.id;if(!!a){t.value.batchSaveHarmParams=!0;try{const o=[],l={harm_group1:265,harm_group2:266,harm_group3:267,harm_group4:268,harm_group5:269,harm_group6:270,harm_group7:271,harm_group8:272};for(const[c,r]of Object.entries(l))if(c in e&&e[c]!==void 0&&e[c]!==null&&e[c]!==""){const v=Array.isArray(e[c])?e[c].join(","):e[c];o.push({addr:r,val:v})}o.length>0?(yield de({id:a,data:o,mode:"batch_save"}),i.success("\u6279\u91CF\u4FDD\u5B58\u6210\u529F")):i.warning("\u6CA1\u6709\u9700\u8981\u4FDD\u5B58\u7684\u6570\u636E")}catch(o){i.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25")}finally{t.value.batchSaveHarmParams=!1}}})}const na=J(()=>[{title:u("sys.util.time"),dataIndex:"created",width:200},...se.value.map(e=>({created:u("sys.util.time"),title:e.name,dataIndex:e.key}))]),N=x([Se(),Se()]),[ca,{reload:da,getRawDataSource:ma}]=Oe({api:Ka,beforeFetch(e){return V({id:O.value.id,date:N.value},e)},afterFetch(){return ma().items.map(a=>V({created:a.created},a.content))},maxHeight:700,columns:na,bordered:!0});function pa(){return E(this,null,function*(){da()})}const[Ee,{openModal:va}]=Ua();function ha(){va(!0,{name:O.value.name,feature:se.value,record:{id:O.value.id,date:N.value}})}const fa=[{field:"comp_mode",label:u("routes.dashboard.dash.compMode"),component:"Select",componentProps:{options:[{label:"1 \u4E0D\u5E73\u8861\u8861",value:1},{label:"2 \u65E0\u529F\u529F\u8865\u507F",value:2},{label:"4 \u8C10\u6CE2\u7EC4",value:4},{label:"6 \u65E0\u529F\u529F+\u8C10\u6CE2\u7EC4\u8865\u507F",value:6},{label:"13 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:13},{label:"14 \u8C10\u6CE2\u7EC4+\u65E0\u529F\u529F\u8865\u507F",value:14},{label:"15 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u65E0\u529F\u529F\u8865\u507F",value:15},{label:"16 \u81EA\u8001\u5316\u53D1\u65E0\u529F\u529F",value:16},{label:"35 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:35},{label:"39 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8C10\u6CE2\u7EC4\u8865\u507F",value:39}]},required:!1,suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.comp_mode)==null?void 0:e.query)||!1,onClick:()=>g("comp_mode",513)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.comp_mode)==null?void 0:a.save)||!1,onClick:()=>C("comp_mode",513)},()=>u("sys.util.save"))])}}],[_a,{getFieldsValue:Fe,setFieldsValue:W,validate:ba}]=G({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:fa}),ya=[{field:"auto_enable",label:u("routes.dashboard.dash.autoEnable"),component:"Select",componentProps:{options:[{label:u("routes.dashboard.dash.disable"),value:0},{label:u("routes.dashboard.dash.enable"),value:1}]},required:!1,suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.auto_enable)==null?void 0:e.query)||!1,onClick:()=>g("auto_enable",512)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.auto_enable)==null?void 0:a.save)||!1,onClick:()=>C("auto_enable",512)},()=>u("sys.util.save"))])}}],[ga,{getFieldsValue:De,setFieldsValue:$,validate:Ca}]=G({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:ya}),oe=x([]),[Ea]=Oe({dataSource:oe,maxHeight:700,columns:Ya,bordered:!0});return(e,a)=>{const n=Aa("ModeSetting");return k(),xe(Pe,null,[p(s(ja),Ia(e.$attrs,{onRegister:s(ae),width:"98%"}),{default:f(()=>[p(s(Ra),{activeKey:q.value,"onUpdate:activeKey":a[1]||(a[1]=o=>q.value=o)},{default:f(()=>[p(s(X),{key:"1",tab:s(u)("dev.info.base")},{default:f(()=>[y("div",eu,[p(s(ze),{onRegister:s(H),class:"w-1/2"},{action:f(()=>[y("div",au,[p(s(Y),{title:s(u)("routes.dashboard.dash.start")},{default:f(()=>{var o;return[(o=te.value)!=null&&o.includes("run")?(k(),A(s(Ae),{key:0})):(k(),A(s(Ae),{style:{color:"#0960bd"},key:"on",onClick:ea}))]}),_:1},8,["title"]),p(s(Y),{title:s(u)("routes.dashboard.dash.stop")},{default:f(()=>{var o;return[(o=te.value)!=null&&o.includes("stp")?(k(),A(s(qe),{key:0})):(k(),A(s(qe),{style:{color:"#0960bd"},key:"off",onClick:aa}))]}),_:1},8,["title"]),p(s(Y),{title:s(u)("routes.dashboard.dash.reset")},{default:f(()=>{var o;return[(o=te.value)!=null&&o.includes("rst")?(k(),A(s(Ie),{key:0})):(k(),A(s(Ie),{style:{color:"#0960bd"},key:"reset",onClick:ua}))]}),_:1},8,["title"])])]),_:1},8,["onRegister"]),p(s(ze),{onRegister:s(Ve),class:"w-1/2"},null,8,["onRegister"])]),p(s(za),{size:"small",bordered:""},{title:f(()=>[y("div",uu,[y("div",su,w(s(u)("dev.info.recentData")),1),y("div",tu,w(Qe.value),1),p(s(m),{type:"link",loading:t.value.reload,onClick:ye},{icon:f(()=>[t.value.reload?(k(),A(s(Na),{key:1})):(k(),A(s(Oa),{key:0}))]),_:1},8,["loading"])])]),default:f(()=>[(k(!0),xe(Pe,null,qa(se.value,(o,l)=>(k(),A(s(Va),{label:o.name,key:l},{default:f(()=>[R(w(o.val)+" ",1),y("span",lu,w(o.unit),1)]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["tab"]),p(s(X),{key:"2",tab:s(u)("dev.info.record")},{default:f(()=>[y("div",ou,[p(s(Qa),{value:N.value,"onUpdate:value":a[0]||(a[0]=o=>N.value=o)},null,8,["value"]),p(s(m),{class:"ml-2",onClick:pa,disabled:!N.value},{default:f(()=>[R(w(s(u)("sys.util.search")),1)]),_:1},8,["disabled"]),p(s(Y),{class:"ml-2",title:s(u)("dev.info.chart")},{default:f(()=>[p(s(m),{type:"link",disabled:!N.value,onClick:ha},{default:f(()=>[p(s(Ta))]),_:1},8,["disabled"])]),_:1},8,["title"])]),p(s(Ne),{onRegister:s(ca)},null,8,["onRegister"])]),_:1},8,["tab"]),p(s(X),{key:"3",tab:s(u)("dev.info.warn")},{default:f(()=>[p(s(Ne),{onRegister:s(Ea)},null,8,["onRegister"])]),_:1},8,["tab"]),p(s(X),{key:"4"},{tab:f(()=>[y("span",null,w(s(u)("routes.dashboard.dash.setting")),1)]),default:f(()=>[y("div",ru,[y("div",iu,[p(s(Ha),{current:M.value,total:3,pageSize:1,simple:"",onChange:Te},null,8,["current"])]),re(y("div",null,[y("div",nu,[p(s(j),{onRegister:s(_a)},null,8,["onRegister"]),p(s(j),{onRegister:s(ga)},null,8,["onRegister"])]),y("div",cu,[p(s(m),{type:"default",loading:t.value.batchQueryCompAuto,onClick:sa},{default:f(()=>[R(w(s(u)("sys.util.batchQuery")),1)]),_:1},8,["loading"]),p(s(m),{type:"default",loading:t.value.batchSaveCompAuto,onClick:ta},{default:f(()=>[R(w(s(u)("sys.util.batchSave")),1)]),_:1},8,["loading"])])],512),[[ie,M.value===1]]),re(y("div",null,[y("div",du,[p(s(j),{onRegister:s(Ue)},null,8,["onRegister"])]),y("div",mu,[p(s(j),{onRegister:s(Ke)},null,8,["onRegister"])]),y("div",pu,[p(s(m),{type:"default",loading:t.value.batchQueryOtherParams,onClick:la},{default:f(()=>[R(w(s(u)("sys.util.batchQuery")),1)]),_:1},8,["loading"]),p(s(m),{type:"default",loading:t.value.batchSaveOtherParams,onClick:oa},{default:f(()=>[R(w(s(u)("sys.util.batchSave")),1)]),_:1},8,["loading"])])],512),[[ie,M.value===2]]),re(y("div",null,[y("div",vu,[p(s(j),{onRegister:s(Xe)},null,8,["onRegister"])]),y("div",hu,[p(s(m),{type:"default",loading:t.value.batchQueryHarmParams,onClick:ra},{default:f(()=>[R(w(s(u)("sys.util.batchQuery")),1)]),_:1},8,["loading"]),p(s(m),{type:"default",loading:t.value.batchSaveHarmParams,onClick:ia},{default:f(()=>[R(w(s(u)("sys.util.batchSave")),1)]),_:1},8,["loading"])])],512),[[ie,M.value===3]])])]),_:1})]),_:1},8,["activeKey"])]),_:1},16,["onRegister"]),p(Za,{onRegister:s(Ee)},null,8,["onRegister"]),p(n,{onRegister:s(Ee),onSuccess:ye},null,8,["onRegister"])],64)}}});var us=Wa(fu,[["__scopeId","data-v-5d293925"]]);export{us as default};
