var K=(C,m,y)=>new Promise((b,r)=>{var h=D=>{try{p(y.next(D))}catch(d){r(d)}},$=D=>{try{p(y.throw(D))}catch(d){r(d)}},p=D=>D.done?b(D.value):Promise.resolve(D.value).then(h,$);p((y=y.apply(C,m)).next())});import{_ as uu}from"./index.69a4dfca.js";import{a as vu}from"./index.bff03604.js";/* empty css               */import{ConnectionMode as I,deviceConnection as k}from"./directConnection.49abe139.js";import{d as eu,e as j,a1 as s,a2 as g,f as t,u as L,a7 as w,a9 as e,a3 as f,a4 as v,V as S,k as B,o as pu,b as Au,U as E,E as l,F as G,ad as Y,a5 as Z,a6 as Bu,q as _u}from"./vue.2e68d871.js";import{aJ as gu,V as yu,U as Cu,K as i}from"./ui.5d3da833.js";import"./utils.93213dc9.js";import"./table.68230543.js";/* empty css                *//* empty css                */import"./useWindowSizeFn.d3b17bbd.js";import"./useContentViewHeight.d0ccb353.js";import"./index.35535828.js";const xu={class:"connection-indicator"},ku={key:0},Iu={key:1},bu=eu({__name:"ConnectionIndicator",props:{status:{type:Object,required:!0},showDetails:{type:Boolean,default:!0}},setup(C){const m=C,y=j(()=>m.status.connected?m.status.mode===I.DIRECT?"processing":m.status.mode===I.SERVER?"success":"default":"default"),b=j(()=>m.status.connected?m.status.mode===I.DIRECT?"\u76F4\u8FDE\u6A21\u5F0F":m.status.mode===I.SERVER?"\u670D\u52A1\u5668\u6A21\u5F0F":"\u8FDE\u63A5\u4E2D...":"\u672A\u8FDE\u63A5"),r=j(()=>{switch(m.status.mode){case I.DIRECT:return"\u5C40\u57DF\u7F51\u76F4\u8FDE";case I.SERVER:return"\u901A\u8FC7\u670D\u52A1\u5668";default:return"\u672A\u77E5"}});return(h,$)=>(s(),g("div",xu,[t(L(gu),{status:y.value,text:b.value},null,8,["status","text"]),C.showDetails?(s(),w(L(Cu),{key:0},{title:e(()=>[f("div",null,[f("div",null,"\u8FDE\u63A5\u6A21\u5F0F: "+v(r.value),1),C.status.localIP?(s(),g("div",ku,"\u8BBE\u5907IP: "+v(C.status.localIP),1)):S("",!0),C.status.error?(s(),g("div",Iu,"\u9519\u8BEF: "+v(C.status.error),1)):S("",!0)])]),default:e(()=>[t(L(yu),{style:{"margin-left":"4px",cursor:"help"}})]),_:1})):S("",!0)]))}});var wu=uu(bu,[["__scopeId","data-v-4e6a49ae"]]);const $u={style:{"margin-bottom":"16px"}},Su={style:{"margin-top":"24px"}},hu={key:1},Tu={style:{"margin-bottom":"8px"}},Uu={key:0,style:{"margin-left":"8px",color:"#52c41a","font-size":"12px"}},zu={class:"communication-log",style:{height:"200px","overflow-y":"auto",border:"1px solid #d9d9d9",padding:"8px",background:"#fafafa","font-family":"monospace","font-size":"12px"}},Nu={style:{color:"#666"}},Pu={key:0,style:{color:"#999","text-align":"center","margin-top":"50px"}},Ru={style:{"margin-top":"8px",color:"#666","font-size":"12px"}},Vu={class:"log-time"},Lu={class:"log-type-tag"},Ou={class:"log-content"},Hu={key:0,class:"log-empty"},Ju=eu({__name:"DirectConnectionTest",setup(C){const m=B(""),y=B(!1),b=B("hex"),r=B("AA010541564B0615"),h=B(!0),$=B(),p=B(""),D=B(""),d=B({mode:I.UNKNOWN,connected:!1,deviceId:null,localIP:null,error:null}),P=B([]),R=B([]),T=B(!1),U=B(null),o=(a,u)=>{P.value.push({time:new Date().toLocaleTimeString(),type:a,content:u}),h.value&&_u(()=>{$.value&&($.value.scrollTop=$.value.scrollHeight)})},_=(a,u)=>{R.value.push({time:new Date().toLocaleTimeString(),type:a,message:u})},tu=()=>{R.value=[]},M=()=>{if(T.value)U.value&&(clearInterval(U.value),U.value=null),T.value=!1,_("info","\u81EA\u52A8\u67E5\u8BE2\u5DF2\u505C\u6B62");else{if(!d.value.connected){i.warning("\u8BF7\u5148\u8FDE\u63A5\u8BBE\u5907");return}T.value=!0,_("info","\u5F00\u59CB\u81EA\u52A8\u67E5\u8BE2\uFF0C\u6BCF3\u79D2\u53D1\u9001\u4E00\u6B21\u67E5\u8BE2\u547D\u4EE4"),Q(),U.value=setInterval(()=>{d.value.connected?Q():(_("info","\u8BBE\u5907\u672A\u8FDE\u63A5\uFF0C\u505C\u6B62\u81EA\u52A8\u67E5\u8BE2"),M())},3e3)}},Q=()=>{try{const F=`AA${(parseInt(m.value)||1).toString(16).padStart(2,"0").toUpperCase()}0541564B0615`,c=new Uint8Array(F.match(/.{1,2}/g).map(z=>parseInt(z,16)));k.send(c.buffer)?_("send",`\u81EA\u52A8\u67E5\u8BE2: ${F}`):_("info",`\u81EA\u52A8\u67E5\u8BE2\u5931\u8D25: ${F}`)}catch(a){_("info",`\u81EA\u52A8\u67E5\u8BE2\u9519\u8BEF: ${a}`)}},O=a=>{switch(a){case I.DIRECT:return"\u5C40\u57DF\u7F51\u76F4\u8FDE";case I.SERVER:return"\u901A\u8FC7\u670D\u52A1\u5668";default:return"\u672A\u8FDE\u63A5"}},au=()=>K(this,null,function*(){const a=Number(m.value);if(!a||Number.isNaN(a)||a<1){i.error("\u8BF7\u8F93\u5165\u8BBE\u5907ID");return}y.value=!0,o("info",`\u5F00\u59CB\u8FDE\u63A5\u8BBE\u5907 ID: ${a}`);try{const u=yield k.connect(a);d.value=u,o("success",`\u8FDE\u63A5\u6210\u529F - \u6A21\u5F0F: ${O(u.mode)}`),i.success("\u8FDE\u63A5\u6210\u529F")}catch(u){o("error",`\u8FDE\u63A5\u5931\u8D25: ${u.message}`),i.error("\u8FDE\u63A5\u5931\u8D25")}finally{y.value=!1}}),nu=()=>{k.disconnect(),o("info","\u5DF2\u65AD\u5F00\u8FDE\u63A5"),i.info("\u5DF2\u65AD\u5F00\u8FDE\u63A5")},ou=()=>{try{if(b.value==="hex"){const a=r.value.replace(/\s+/g,"");if(!/^[0-9a-fA-F]+$/.test(a)){o("error","\u65E0\u6548\u7684\u5341\u516D\u8FDB\u5236\u683C\u5F0F"),i.error("\u8BF7\u8F93\u5165\u6709\u6548\u7684\u5341\u516D\u8FDB\u5236\u5B57\u7B26\u4E32\uFF080-9, a-f, A-F\uFF09");return}if(a.length%2!==0){o("error","\u5341\u516D\u8FDB\u5236\u5B57\u7B26\u4E32\u957F\u5EA6\u5FC5\u987B\u662F\u5076\u6570"),i.error("\u5341\u516D\u8FDB\u5236\u5B57\u7B26\u4E32\u957F\u5EA6\u5FC5\u987B\u662F\u5076\u6570");return}const u=new Uint8Array(a.match(/.{1,2}/g).map(c=>parseInt(c,16)));k.send(u.buffer)?(o("success",`\u5341\u516D\u8FDB\u5236\u547D\u4EE4\u5DF2\u53D1\u9001: ${a}`),_("send",`\u53D1\u9001\u547D\u4EE4: ${a}`),i.success("\u547D\u4EE4\u5DF2\u53D1\u9001")):(o("warning",`\u9700\u8981\u901A\u8FC7API\u53D1\u9001: ${a}`),_("info",`\u9700\u8981\u901A\u8FC7API\u53D1\u9001: ${a}`),i.warning("\u8BF7\u4F7F\u7528API\u63A5\u53E3\u53D1\u9001\u547D\u4EE4"))}else{const a=JSON.parse(r.value);k.send(a)?(o("success",`\u547D\u4EE4\u5DF2\u53D1\u9001(\u76F4\u8FDE): ${r.value}`),_("send",`\u53D1\u9001\u547D\u4EE4: ${r.value}`),i.success("\u547D\u4EE4\u5DF2\u53D1\u9001")):(o("warning",`\u9700\u8981\u901A\u8FC7API\u53D1\u9001: ${r.value}`),_("info",`\u9700\u8981\u901A\u8FC7API\u53D1\u9001: ${r.value}`),i.warning("\u8BF7\u4F7F\u7528API\u63A5\u53E3\u53D1\u9001\u547D\u4EE4"))}}catch(a){o("error",`\u547D\u4EE4\u9519\u8BEF: ${a.message}`),i.error("\u547D\u4EE4\u683C\u5F0F\u9519\u8BEF")}},lu=()=>{r.value=""},ru=()=>{P.value=[]},su=()=>{},iu=()=>{if(!p.value.trim()){i.warning("\u8BF7\u8F93\u5165\u6865\u63A5\u5730\u5740");return}if(!p.value.startsWith("ws://")){i.error("\u6865\u63A5\u5730\u5740\u5FC5\u987B\u4EE5 ws:// \u5F00\u5934");return}try{localStorage.setItem("wsBridgeUrl",p.value.trim()),D.value=p.value.trim(),o("success",`\u6865\u63A5\u5730\u5740\u5DF2\u4FDD\u5B58: ${p.value.trim()}`),i.success("\u6865\u63A5\u5730\u5740\u5DF2\u4FDD\u5B58")}catch(a){o("error","\u4FDD\u5B58\u6865\u63A5\u5730\u5740\u5931\u8D25"),i.error("\u4FDD\u5B58\u5931\u8D25")}},du=()=>{try{localStorage.removeItem("wsBridgeUrl"),D.value="",p.value="",o("info","\u6865\u63A5\u5730\u5740\u5DF2\u6E05\u9664"),i.info("\u6865\u63A5\u5730\u5740\u5DF2\u6E05\u9664")}catch(a){o("error","\u6E05\u9664\u6865\u63A5\u5730\u5740\u5931\u8D25"),i.error("\u6E05\u9664\u5931\u8D25")}},cu=()=>{try{const a=localStorage.getItem("wsBridgeUrl");a&&(D.value=a,p.value=a,o("info",`\u5DF2\u52A0\u8F7D\u6865\u63A5\u5730\u5740: ${a}`))}catch(a){o("warning","\u52A0\u8F7D\u6865\u63A5\u5730\u5740\u5931\u8D25")}};return pu(()=>{o("info","\u6D4B\u8BD5\u9875\u9762\u5DF2\u52A0\u8F7D"),cu(),k.onMessage(a=>{let u="";if(a instanceof ArrayBuffer){const F=new Uint8Array(a);u=`[HEX] ${Array.from(F).map(x=>x.toString(16).padStart(2,"0")).join(" ")}`}else if(typeof a=="string")try{const F=new TextEncoder().encode(a);F.length>0&&F.every(c=>c<128)?u=`[TEXT] ${a}`:u=`[HEX] ${Array.from(F).map(x=>x.toString(16).padStart(2,"0")).join(" ")}`}catch(F){u=`[TEXT] ${a}`}else u=JSON.stringify(a,null,2);o("data",`\u6536\u5230\u6570\u636E: ${u}`),_("receive",u)}),k.onStatusChange(a=>{d.value=a,o("info",`\u72B6\u6001\u53D8\u5316: ${O(a.mode)} - ${a.connected?"\u5DF2\u8FDE\u63A5":"\u672A\u8FDE\u63A5"}`)}),k.onError(a=>{o("error",`\u9519\u8BEF: ${a}`)})}),Au(()=>{U.value&&clearInterval(U.value),k.disconnect()}),(a,u)=>{const F=E("a-input"),c=E("a-form-item"),x=E("a-form"),z=E("a-col"),A=E("a-button"),V=E("a-space"),q=E("a-row"),H=E("a-tag"),Eu=E("a-divider"),N=E("a-descriptions-item"),Fu=E("a-descriptions"),J=E("a-card"),W=E("a-radio"),fu=E("a-radio-group"),mu=E("a-textarea"),Du=E("a-switch");return s(),w(L(vu),{title:"\u8BBE\u5907\u76F4\u8FDE\u6D4B\u8BD5"},{default:e(()=>[t(J,{title:"\u8FDE\u63A5\u63A7\u5236"},{default:e(()=>[f("div",$u,[t(q,{gutter:16,align:"middle"},{default:e(()=>[t(z,{span:8},{default:e(()=>[t(x,{layout:"vertical"},{default:e(()=>[t(c,{label:"\u8BBE\u5907ID"},{default:e(()=>[t(F,{value:m.value,"onUpdate:value":u[0]||(u[0]=n=>m.value=n),placeholder:"\u8BF7\u8F93\u5165\u8BBE\u5907ID","allow-clear":"",size:"large",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),t(z,{span:16},{default:e(()=>[f("div",Su,[t(V,null,{default:e(()=>[t(A,{type:"primary",onClick:au,loading:y.value},{default:e(()=>[...u[10]||(u[10]=[l(" \u8FDE\u63A5\u8BBE\u5907 ",-1)])]),_:1},8,["loading"]),t(A,{onClick:nu,disabled:!d.value.connected},{default:e(()=>[...u[11]||(u[11]=[l(" \u65AD\u5F00\u8FDE\u63A5 ",-1)])]),_:1},8,["disabled"])]),_:1})])]),_:1})]),_:1}),t(q,{gutter:16,style:{"margin-top":"16px"}},{default:e(()=>[t(z,{span:12},{default:e(()=>[t(x,{layout:"vertical"},{default:e(()=>[t(c,{label:"\u6865\u63A5\u5730\u5740 (\u53EF\u9009)"},{default:e(()=>[t(F,{value:p.value,"onUpdate:value":u[1]||(u[1]=n=>p.value=n),placeholder:"ws://127.0.0.1:18900","allow-clear":"",onChange:su},{addonAfter:e(()=>[t(A,{size:"small",onClick:iu,type:"link"},{default:e(()=>[...u[12]||(u[12]=[l(" \u4FDD\u5B58 ",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),t(z,{span:12},{default:e(()=>[t(x,{layout:"vertical"},{default:e(()=>[t(c,{label:"\u5F53\u524D\u6865\u63A5"},{default:e(()=>[D.value?(s(),w(H,{key:0,color:"blue"},{default:e(()=>[l(v(D.value),1)]),_:1})):(s(),w(H,{key:1,color:"default"},{default:e(()=>[...u[13]||(u[13]=[l(" \u672A\u8BBE\u7F6E ",-1)])]),_:1})),D.value?(s(),w(A,{key:2,size:"small",type:"link",danger:"",onClick:du,style:{"margin-left":"8px"}},{default:e(()=>[...u[14]||(u[14]=[l(" \u6E05\u9664 ",-1)])]),_:1})):S("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),t(Eu),t(Fu,{bordered:"",column:2},{default:e(()=>[t(N,{label:"\u8FDE\u63A5\u72B6\u6001"},{default:e(()=>[t(wu,{status:d.value},null,8,["status"])]),_:1}),t(N,{label:"\u8BBE\u5907ID"},{default:e(()=>[l(v(d.value.deviceId||"-"),1)]),_:1}),t(N,{label:"\u8FDE\u63A5\u6A21\u5F0F"},{default:e(()=>[l(v(O(d.value.mode)),1)]),_:1}),t(N,{label:"\u8BBE\u5907IP"},{default:e(()=>[l(v(d.value.localIP||"-"),1)]),_:1}),t(N,{label:"\u9519\u8BEF\u4FE1\u606F",span:2},{default:e(()=>[d.value.error?(s(),w(H,{key:0,color:"error"},{default:e(()=>[l(v(d.value.error),1)]),_:1})):(s(),g("span",hu,"\u65E0"))]),_:1})]),_:1})]),_:1}),t(J,{title:"\u547D\u4EE4\u53D1\u9001",style:{"margin-top":"16px"}},{default:e(()=>[t(x,{layout:"vertical"},{default:e(()=>[t(c,{label:"\u547D\u4EE4\u683C\u5F0F"},{default:e(()=>[t(fu,{value:b.value,"onUpdate:value":u[2]||(u[2]=n=>b.value=n)},{default:e(()=>[t(W,{value:"hex"},{default:e(()=>[...u[15]||(u[15]=[l("\u5341\u516D\u8FDB\u5236 (HEX)",-1)])]),_:1}),t(W,{value:"json"},{default:e(()=>[...u[16]||(u[16]=[l("JSON\u683C\u5F0F",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),t(c,{label:"\u901A\u4FE1\u8BB0\u5F55"},{default:e(()=>[f("div",Tu,[t(A,{onClick:tu,size:"small",style:{"margin-right":"8px"}},{default:e(()=>[...u[17]||(u[17]=[l(" \u6E05\u7A7A\u8BB0\u5F55 ",-1)])]),_:1}),t(A,{onClick:M,size:"small",type:"primary",disabled:T.value},{default:e(()=>[l(v(T.value?"\u505C\u6B62\u81EA\u52A8\u67E5\u8BE2":"\u5F00\u59CB\u81EA\u52A8\u67E5\u8BE2"),1)]),_:1},8,["disabled"]),T.value?(s(),g("span",Uu," \u6BCF3\u79D2\u81EA\u52A8\u53D1\u9001\u67E5\u8BE2\u547D\u4EE4 ")):S("",!0)]),f("div",zu,[(s(!0),g(G,null,Y(R.value,(n,X)=>(s(),g("div",{key:X,class:Z(n.type),style:{"margin-bottom":"4px"}},[f("span",Nu,"["+v(n.time)+"]",1),f("span",{style:Bu({color:n.type==="send"?"#1890ff":n.type==="receive"?"#52c41a":"#faad14"})},v(n.message),5)],2))),128)),R.value.length===0?(s(),g("div",Pu," \u6682\u65E0\u901A\u4FE1\u8BB0\u5F55 ")):S("",!0)])]),_:1}),b.value==="hex"?(s(),w(c,{key:0,label:"\u5341\u516D\u8FDB\u5236\u547D\u4EE4"},{default:e(()=>[t(F,{value:r.value,"onUpdate:value":u[3]||(u[3]=n=>r.value=n),placeholder:"\u4F8B\u5982: AA010541564B0615 (\u67E5\u8BE201\u53F7\u8BBE\u5907)","allow-clear":""},null,8,["value"]),f("div",Ru,[u[22]||(u[22]=f("div",null,"\u5E38\u7528\u547D\u4EE4\uFF0801\u53F7\u8BBE\u5907\uFF09\uFF1A",-1)),t(V,{wrap:"",style:{"margin-top":"4px"}},{default:e(()=>[t(A,{size:"small",onClick:u[4]||(u[4]=n=>r.value="AA010541564B0615")},{default:e(()=>[...u[18]||(u[18]=[l("\u67E5\u8BE2",-1)])]),_:1}),t(A,{size:"small",onClick:u[5]||(u[5]=n=>r.value="aa010552554E")},{default:e(()=>[...u[19]||(u[19]=[l("\u8FD0\u884C",-1)])]),_:1}),t(A,{size:"small",onClick:u[6]||(u[6]=n=>r.value="aa0105535450")},{default:e(()=>[...u[20]||(u[20]=[l("\u505C\u6B62",-1)])]),_:1}),t(A,{size:"small",onClick:u[7]||(u[7]=n=>r.value="aa0105525354")},{default:e(()=>[...u[21]||(u[21]=[l("\u590D\u4F4D",-1)])]),_:1})]),_:1}),u[23]||(u[23]=f("div",{style:{"margin-top":"4px","font-size":"11px",color:"#999"}}," \u63D0\u793A\uFF1A\u5982\u679C\u8BBE\u5907\u5E8F\u5217\u53F7\u4E0D\u662F01\uFF0C\u8BF7\u4FEE\u6539\u547D\u4EE4\u4E2D\u7684\u7B2C2\u4E2A\u5B57\u8282 ",-1))])]),_:1})):(s(),w(c,{key:1,label:"\u547D\u4EE4\u6570\u636E (JSON\u683C\u5F0F)"},{default:e(()=>[t(mu,{value:r.value,"onUpdate:value":u[8]||(u[8]=n=>r.value=n),rows:6,placeholder:'{"type": "control", "action": "query", "params": {}}'},null,8,["value"])]),_:1})),t(c,null,{default:e(()=>[t(V,null,{default:e(()=>[t(A,{type:"primary",onClick:ou,disabled:!d.value.connected},{default:e(()=>[...u[24]||(u[24]=[l(" \u53D1\u9001\u547D\u4EE4 ",-1)])]),_:1},8,["disabled"]),t(A,{onClick:lu},{default:e(()=>[...u[25]||(u[25]=[l(" \u6E05\u7A7A ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(J,{title:"\u63A5\u6536\u65E5\u5FD7",style:{"margin-top":"16px"}},{default:e(()=>[t(V,{style:{"margin-bottom":"12px"}},{default:e(()=>[t(A,{onClick:ru,size:"small"},{default:e(()=>[...u[26]||(u[26]=[l(" \u6E05\u7A7A\u65E5\u5FD7 ",-1)])]),_:1}),t(Du,{checked:h.value,"onUpdate:checked":u[9]||(u[9]=n=>h.value=n),"checked-children":"\u81EA\u52A8\u6EDA\u52A8","un-checked-children":"\u81EA\u52A8\u6EDA\u52A8"},null,8,["checked"])]),_:1}),f("div",{class:"log-container",ref_key:"logContainer",ref:$},[(s(!0),g(G,null,Y(P.value,(n,X)=>(s(),g("div",{key:X,class:Z(["log-item",n.type])},[f("span",Vu,v(n.time),1),f("span",Lu,v(n.type),1),f("span",Ou,v(n.content),1)],2))),128)),P.value.length===0?(s(),g("div",Hu," \u6682\u65E0\u65E5\u5FD7 ")):S("",!0)],512)]),_:1})]),_:1})}}});var ne=uu(Ju,[["__scopeId","data-v-5dede8ec"]]);export{ne as default};
