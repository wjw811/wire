var c=(v,s,f)=>new Promise((h,p)=>{var m=r=>{try{a(f.next(r))}catch(i){p(i)}},o=r=>{try{a(f.throw(r))}catch(i){p(i)}},a=r=>r.done?h(r.value):Promise.resolve(r.value).then(m,o);a((f=f.apply(v,s)).next())});import{_ as L,b as O,I as U}from"./index.69a4dfca.js";/* empty css                *//* empty css                *//* empty css               */import{k as B,e as R,x as H,d as K,o as M,b as $,a1 as _,a2 as E,F as S,ad as V,f as g,a9 as C,a3 as F,a6 as k,E as j,a4 as b,a7 as q,u as d,V as A}from"./vue.2e68d871.js";import{c as N}from"./index.cac8beb7.js";import{K as D,U as T,b4 as G,b5 as J,aE as Q,b3 as W}from"./ui.5d3da833.js";import{d as X}from"./data.080f0cdf.js";import"./utils.93213dc9.js";import"./table.68230543.js";function Y(v,s={}){const{interval:f=3e3,immediate:h=!0,maxRetries:p=3,onError:m}=s,o=B(!1),a=B(!1),r=B(null),i=B(null),l=B(0);let n=null;const t=R(()=>o.value&&!a.value?"\u8F6E\u8BE2\u4E2D":a.value?"\u5DF2\u6682\u505C":"\u5DF2\u505C\u6B62"),e=()=>c(this,null,function*(){try{const x=yield v();return r.value=x,i.value=null,l.value=0,x}catch(x){throw i.value=x,l.value<p?l.value++:(m==null||m(x),y()),x}}),w=()=>c(this,null,function*(){if(!(!o.value||a.value)){try{yield e()}catch(x){}o.value&&!a.value&&(n=window.setTimeout(w,f))}}),u=()=>c(this,null,function*(){o.value||(o.value=!0,a.value=!1,l.value=0,h&&(yield e()),w())}),y=()=>{a.value=!0,n&&(clearTimeout(n),n=null)},I=()=>{!o.value||!a.value||(a.value=!1,l.value=0,w())},P=()=>{o.value=!1,a.value=!1,l.value=0,n&&(clearTimeout(n),n=null)},z=()=>{P(),r.value=null,i.value=null};return H(()=>{P()}),{isPolling:o,isPaused:a,latestData:r,error:i,retryCount:l,statusText:t,start:u,pause:y,resume:I,stop:P,reset:z,execute:e}}function Z(){const v=B([]),s=B(!1),f=B(null),{isPolling:h,start:p,stop:m,pause:o,resume:a}=Y(()=>c(this,null,function*(){return[]}),{interval:3e3,immediate:!1,maxRetries:3,onError:u=>{D.error("\u8BBE\u5907\u5217\u8868\u67E5\u8BE2\u5931\u8D25")}}),r=R(()=>v.value.filter(u=>u.limit&&!u.limit.includes("run")).length),i=R(()=>v.value.filter(u=>u.warn).length),l=u=>c(this,null,function*(){try{s.value=!0,yield N({id:u.id,serial:u.serial,cmd:"run"}),D.success("\u8BBE\u5907\u542F\u52A8\u6210\u529F"),yield e()}catch(y){throw D.error("\u8BBE\u5907\u542F\u52A8\u5931\u8D25"),y}finally{s.value=!1}}),n=u=>c(this,null,function*(){try{s.value=!0,yield N({id:u.id,serial:u.serial,cmd:"stp"}),D.success("\u8BBE\u5907\u505C\u6B62\u6210\u529F"),yield e()}catch(y){throw D.error("\u8BBE\u5907\u505C\u6B62\u5931\u8D25"),y}finally{s.value=!1}}),t=u=>c(this,null,function*(){try{s.value=!0,yield N({id:u.id,serial:u.serial,cmd:"rst"}),D.success("\u8BBE\u5907\u91CD\u7F6E\u6210\u529F"),yield e()}catch(y){throw D.error("\u8BBE\u5907\u91CD\u7F6E\u5931\u8D25"),y}finally{s.value=!1}}),e=()=>c(this,null,function*(){return[]});return{devices:v,loading:s,error:f,isPolling:h,onlineCount:r,faultCount:i,startPolling:p,stopPolling:m,pausePolling:o,resumePolling:a,startDevice:l,stopDevice:n,resetDevice:t,refetch:e,setDevices:u=>{v.value=u}}}const ee={class:"md:flex flex-wrap"},te={class:"px-4 min-h-72 overflow-auto max-h-[360px]"},ae={class:"text-gray-500 pr-2"},ue={class:"text-gray-500 pl-2"},le={key:0,style:{color:"#999","text-align":"center","margin-top":"20px"}},se=K({__name:"DevBox_New",props:{loading:{type:Boolean}},setup(v){const{t:s}=O(),{startDevice:f,stopDevice:h,resetDevice:p,startPolling:m,stopPolling:o}=Z(),a=l=>c(this,null,function*(){try{yield f(l)}catch(n){}}),r=l=>c(this,null,function*(){try{yield h(l)}catch(n){}}),i=l=>c(this,null,function*(){try{yield p(l)}catch(n){}});return M(()=>{}),$(()=>{}),(l,n)=>(_(),E("div",ee,[(_(!0),E(S,null,V(d(X),t=>(_(),E("div",{key:t.id,class:"md:w-1/4 w-full !md:mt-0"},[g(d(W),{size:"small",loading:v.loading,title:t.name||`\u8BBE\u5907${t.id}`,bodyStyle:{maxHeight:"400px"},class:"!m-2"},{extra:C(()=>{var e;return[F("span",{style:k({display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:(e=t.limit)!=null&&e.includes("run")?"#52c41a":"#1890ff",marginRight:"6px",boxShadow:"0 0 4px"})},null,4),j(" "+b(t.time)+" ",1),t.warn?(_(),q(d(U),{key:0,icon:"warning|svg",size:20,style:{"margin-left":"4px"}})):A("",!0)]}),actions:C(()=>[g(d(T),{title:d(s)("routes.dashboard.dash.start")},{default:C(()=>{var e;return[g(d(G),{style:k({color:(e=t.limit)!=null&&e.includes("run")?"#0000003f":void 0}),onClick:()=>a(t)},null,8,["style","onClick"])]}),_:2},1032,["title"]),g(d(T),{title:d(s)("routes.dashboard.dash.stop")},{default:C(()=>{var e;return[g(d(J),{style:k({color:(e=t.limit)!=null&&e.includes("stp")?"#0000003f":void 0}),onClick:()=>r(t)},null,8,["style","onClick"])]}),_:2},1032,["title"]),g(d(T),{title:d(s)("routes.dashboard.dash.reset")},{default:C(()=>{var e;return[g(d(Q),{style:k({color:(e=t.limit)!=null&&e.includes("rst")?"#0000003f":void 0}),onClick:()=>i(t)},null,8,["style","onClick"])]}),_:2},1032,["title"])]),default:C(()=>[F("div",te,[(_(!0),E(S,null,V(t.data,(e,w)=>(_(),E("div",{class:"flex",key:w},[F("div",ae,b(e.k)+":",1),F("div",null,b(e.v),1),F("div",ue,b(e.u),1)]))),128)),!t.data||t.data.length===0?(_(),E("div",le," \u6682\u65E0\u6570\u636E ")):A("",!0)])]),_:2},1032,["loading","title"])]))),128))]))}});var Be=L(se,[["__scopeId","data-v-7562dcbf"]]);export{Be as default};
