# 移动端访问故障排除指南

## 问题：移动端访问 http://10.10.100.101:18080/device_direct.html 无响应

### 快速诊断步骤

1. **运行诊断脚本**
   - 双击运行 `诊断服务器.bat` 或 `check_server.ps1`
   - 检查服务器状态、端口监听、IP地址等信息

2. **检查服务器是否运行**
   - 打开任务管理器，查看是否有 `device_server.exe` 进程
   - 如果没有，运行 `start_server.bat` 启动服务器

3. **检查端口监听**
   - 打开命令提示符，运行：`netstat -ano | findstr "18080"`
   - 应该看到类似：`TCP    0.0.0.0:18080           0.0.0.0:0              LISTENING`

4. **检查防火墙**
   - Windows防火墙可能阻止了端口访问
   - 运行以下命令添加防火墙规则：
   ```cmd
   netsh advfirewall firewall add rule name="Device Server HTTP" dir=in action=allow protocol=TCP localport=18080
   netsh advfirewall firewall add rule name="Device Server WS" dir=in action=allow protocol=TCP localport=18900
   ```

5. **检查网络连接**
   - 确保移动设备和服务器在同一网络（同一WiFi）
   - 确保IP地址正确（不是127.0.0.1或localhost）
   - 在服务器上ping移动设备的IP，或在移动设备上ping服务器IP

6. **检查静态文件路径**
   - 确保 `_runtime` 文件夹存在且包含 `device_direct.html`
   - 检查 `start_server.bat` 中的静态文件路径是否正确

### 常见问题及解决方案

#### 问题1：服务器启动失败
**症状**：运行 `start_server.bat` 后立即退出或报错

**解决方案**：
- 检查 `device_server.exe` 是否存在
- 检查 `_runtime` 文件夹是否存在
- 查看错误信息，确认静态文件路径是否正确

#### 问题2：端口被占用
**症状**：启动时提示端口已被使用

**解决方案**：
- 运行 `stop_server.bat` 停止现有服务
- 或手动结束占用端口的进程：
  ```cmd
  netstat -ano | findstr "18080"
  taskkill /F /PID <进程ID>
  ```

#### 问题3：防火墙阻止访问
**症状**：本地可以访问，但移动端无法访问

**解决方案**：
- 添加防火墙规则（见上方命令）
- 或临时关闭Windows防火墙测试

#### 问题4：IP地址不正确
**症状**：使用127.0.0.1可以访问，但使用局域网IP无法访问

**解决方案**：
- 确保服务器监听在 `0.0.0.0`（所有接口），而不是 `127.0.0.1`
- 检查 `start_server.bat` 中的启动参数：`--http 0.0.0.0:18080`
- 使用正确的局域网IP地址（如 10.10.100.101）

#### 问题5：静态文件路径错误
**症状**：服务器启动但返回404错误

**解决方案**：
- 检查 `main.go` 中的默认路径：`../客户交付包/_runtime`
- 或使用 `start_server.bat` 中指定的路径
- 确保 `device_direct.html` 文件存在于静态目录中

### 手动启动服务器

如果自动启动失败，可以手动启动：

```cmd
cd static\standalone-server
device_server.exe --static "_runtime" --http 0.0.0.0:18080 --bridge 0.0.0.0:18900 --device tcp://10.10.100.254:18899
```

### 测试连接

1. **本地测试**：
   - 在服务器上打开浏览器访问：`http://127.0.0.1:18080/device_direct.html`
   - 应该能正常显示页面

2. **局域网测试**：
   - 在移动设备浏览器访问：`http://10.10.100.101:18080/device_direct.html`
   - 如果无法访问，检查防火墙和网络设置

### 获取帮助

如果以上方法都无法解决问题，请检查：
- 服务器日志输出
- Windows事件查看器
- 网络连接状态
- 防火墙日志


