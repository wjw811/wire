var xa=Object.defineProperty,Pa=Object.defineProperties;var Sa=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var Aa=Object.prototype.hasOwnProperty,qa=Object.prototype.propertyIsEnumerable;var we=(B,u,i)=>u in B?xa(B,u,{enumerable:!0,configurable:!0,writable:!0,value:i}):B[u]=i,Q=(B,u)=>{for(var i in u||(u={}))Aa.call(u,i)&&we(B,i,u[i]);if(Be)for(var i of Be(u))qa.call(u,i)&&we(B,i,u[i]);return B},ke=(B,u)=>Pa(B,Sa(u));var D=(B,u,i)=>new Promise((N,q)=>{var t=h=>{try{M(i.next(h))}catch(W){q(W)}},ee=h=>{try{M(i.throw(h))}catch(W){q(W)}},M=h=>h.done?N(h.value):Promise.resolve(h.value).then(t,ee);M((i=i.apply(B,u)).next())});import{d as Ia,k as x,e as U,n as d,w as Ra,q as T,b as Oa,L as Na,U as za,a1 as k,a2 as xe,f as p,a9 as _,u as s,a3 as g,a7 as A,a4 as w,F as Pe,ad as Va,E as R,t as ce,A as de,a8 as Qa}from"./vue.2e68d871.js";import{a8 as m,T as Se,b2 as Ta,b8 as K,U as J,b4 as Ae,b5 as qe,aE as Ie,aX as Ha,b9 as Ma,aK as Wa,ba as $a,bb as Ga,bc as ja,_ as La}from"./ui.3c499a62.js";import{b as Ua,aR as X,_ as Ka,h as Ja}from"./index.f8dcff9b.js";/* empty css                */import{u as Re,D as Oe}from"./index.93c8456d.js";import{j as $,B as G}from"./useForm.8bc02932.js";/* empty css               */import{a as Xa,B as Ya}from"./index.a39401d5.js";import{u as Za}from"./index.3d9df1da.js";import{i as eu,h as au}from"./index.9d843d40.js";import{u as Ne,B as ze}from"./useTable.0365df15.js";import{i as uu,b as su,w as tu}from"./index.data.e4bafa43.js";import{s as H,c as O,b as Y,a as Z,d as me}from"./index.2a183fc3.js";import lu from"./chart.9019d13e.js";import"./utils.b124f726.js";import"./table.68230543.js";/* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               */import"./index.8e12a0dc.js";import"./download.1a473a50.js";import"./index.e09f6ddc.js";/* empty css                */import"./useWindowSizeFn.7b554b6f.js";import"./index.c762d615.js";/* empty css                *//* empty css                */import"./useContentViewHeight.31b45b6e.js";import"./sortable.esm.e8ee5a53.js";/* empty css               */import"./gateway.68a1dc2f.js";import"./data.1ea74f5c.js";import"./useECharts.b9c82683.js";import"./charts.e5d90eae.js";const ou={class:"flex gap-5"},ru={class:"flex items-center gap-4"},iu={class:"text-sm border-b border-[#d9d9d9] flex items-center"},nu={class:"py-3 pl-4"},cu={class:"px-3 text-xs font-normal text-gray-400"},du={class:"text-gray-400"},mu={class:"flex"},pu={class:"p-2"},vu={class:"flex justify-end mb-4"},hu={class:"param-form-container"},fu={class:"mt-4 text-right space-x-2"},_u={class:"param-form-container"},bu={class:"param-form-container"},yu={class:"mt-4 text-right space-x-2"},gu={class:"param-form-container"},Cu={class:"mt-4 text-right space-x-2"},Fu=Ia({__name:"info",setup(B){const{t:u}=Ua(),{createMessage:i}=Ja(),N=x({}),q=x("1"),t=x({batchQueryCompAuto:!1,batchSaveCompAuto:!1,batchQueryOtherParams:!1,batchSaveOtherParams:!1,batchQueryHarmParams:!1,batchSaveHarmParams:!1,reload:!1}),[ee,{setDrawerProps:M}]=Xa(e=>D(this,null,function*(){h.value=[],ae.value=[],ne.value=[],ie.value=!1,z.value=1,t.value={batchQueryCompAuto:!1,batchSaveCompAuto:!1,batchQueryOtherParams:!1,batchSaveOtherParams:!1,batchQueryHarmParams:!1,batchSaveHarmParams:!1,reload:!1},N.value=e==null?void 0:e.record,M({confirmLoading:!1,title:u("dev.info.title")+"-"+e.record.name}),_e(),(e==null?void 0:e.openParam)===!0?q.value="4":q.value="1"})),h=x({}),[W]=Re({title:u("dev.info.title"),data:h,column:1,schema:uu}),ae=x([]),[Ve]=Re({title:u("dev.info.recentWarn"),data:ae,column:1,schema:su}),ue=U(()=>{var c,o;const e=((c=h.value)==null?void 0:c.feature)||[],a=((o=h.value)==null?void 0:o.history)||{};return e.map(l=>ke(Q({},l),{val:(a==null?void 0:a.content[l.key])!==void 0?a==null?void 0:a.content[l.key]:"-"}))}),Qe=U(()=>{var a;return(((a=h.value)==null?void 0:a.history)||{}).created}),se=U(()=>{var a,c;return((c=(((a=h.value)==null?void 0:a.history)||{}).content)==null?void 0:c.limit)||["run","stp","rst"]}),z=x(1);function Te(e){z.value=e}const pe=[{label:u("routes.dashboard.dash.disable"),value:0},{label:u("routes.dashboard.dash.enable"),value:1}],He=[{label:u("routes.dashboard.dash.outflow"),value:0},{label:u("routes.dashboard.dash.inflow"),value:1}],Me=[{label:u("routes.dashboard.dash.outflow"),value:0},{label:u("routes.dashboard.dash.inflow"),value:1}],We=[{label:u("routes.dashboard.dash.cabinet"),value:0},{label:u("routes.dashboard.dash.capacitor"),value:1}],$e=[{label:u("routes.dashboard.dash.cabinet"),value:0},{label:u("routes.dashboard.dash.capacitor"),value:1}];function I(e,a){if(a==null||a==="")return Promise.resolve();const c=Number(a);return Number.isNaN(c)?Promise.reject(u("routes.dashboard.dash.inputNumber")):c===0||c>=2&&c<=50?Promise.resolve():Promise.reject(u("routes.dashboard.dash.allowRange"))}const te=[{field:"auto_enable",label:u("routes.dashboard.dash.autoEnable"),component:"Select",componentProps:{options:pe}},{field:"comp_mode",label:u("routes.dashboard.dash.compMode"),component:"Select",componentProps:{options:[{label:"1 \u4E0D\u5E73\u8861\u8861",value:1},{label:"2 \u65E0\u529F\u529F\u8865\u507F",value:2},{label:"4 \u8C10\u6CE2\u7EC4",value:4},{label:"6 \u65E0\u529F\u529F+\u8C10\u6CE2\u7EC4\u8865\u507F",value:6},{label:"13 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:13},{label:"14 \u8C10\u6CE2\u7EC4+\u65E0\u529F\u529F\u8865\u507F",value:14},{label:"15 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u65E0\u529F\u529F\u8865\u507F",value:15},{label:"16 \u81EA\u8001\u5316\u53D1\u65E0\u529F\u529F",value:16},{label:"35 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:35},{label:"39 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8C10\u6CE2\u7EC4\u8865\u507F",value:39}]}},{field:"in_sample_pos",label:u("routes.dashboard.dash.inSamplePos"),component:"Select",componentProps:{options:We},suffix:()=>{var e;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:!1,onClick:()=>F("in_sample_pos",17)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((e=t.value.in_sample_pos)==null?void 0:e.save)||!1,onClick:()=>E("in_sample_pos",17)},()=>u("sys.util.save"))])}},{field:"in_sample_dir",label:u("routes.dashboard.dash.inSampleDir"),component:"Select",componentProps:{options:He},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.in_sample_dir)==null?void 0:e.query)||!1,onClick:()=>F("in_sample_dir",15)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.in_sample_dir)==null?void 0:a.save)||!1,onClick:()=>E("in_sample_dir",15)},()=>u("sys.util.save"))])}},{field:"in_ct_ratio",label:u("routes.dashboard.dash.inCtRatio"),component:"InputNumber",componentProps:{min:1,max:1e4,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.in_ct_ratio)==null?void 0:e.query)||!1,onClick:()=>F("in_ct_ratio",241)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.in_ct_ratio)==null?void 0:a.save)||!1,onClick:()=>E("in_ct_ratio",241)},()=>u("sys.util.save"))])}},{field:"dev_sample_enable",label:u("routes.dashboard.dash.devSampleEnable"),component:"Select",componentProps:{options:pe},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.dev_sample_enable)==null?void 0:e.query)||!1,onClick:()=>F("dev_sample_enable",16)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.dev_sample_enable)==null?void 0:a.save)||!1,onClick:()=>E("dev_sample_enable",16)},()=>u("sys.util.save"))])}},{field:"dev_sample_pos",label:u("routes.dashboard.dash.devSamplePos"),component:"Select",componentProps:{options:$e},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.dev_sample_pos)==null?void 0:e.query)||!1,onClick:()=>F("dev_sample_pos",13)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.dev_sample_pos)==null?void 0:a.save)||!1,onClick:()=>E("dev_sample_pos",13)},()=>u("sys.util.save"))])}},{field:"dev_sample_dir",label:u("routes.dashboard.dash.devSampleDir"),component:"Select",componentProps:{options:Me},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.dev_sample_dir)==null?void 0:e.query)||!1,onClick:()=>F("dev_sample_dir",14)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.dev_sample_dir)==null?void 0:a.save)||!1,onClick:()=>E("dev_sample_dir",14)},()=>u("sys.util.save"))])}},{field:"dev_ct_ratio",label:u("routes.dashboard.dash.devCtRatio"),component:"InputNumber",componentProps:{min:1,max:1e4,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.dev_ct_ratio)==null?void 0:e.query)||!1,onClick:()=>F("dev_ct_ratio",242)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.dev_ct_ratio)==null?void 0:a.save)||!1,onClick:()=>E("dev_ct_ratio",242)},()=>u("sys.util.save"))])}},{field:"harm_group1",label:u("routes.dashboard.dash.harmGroup",[1]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group1)==null?void 0:e.query)||!1,onClick:()=>F("harm_group1",265)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group1)==null?void 0:a.save)||!1,onClick:()=>E("harm_group1",265)},()=>u("sys.util.save"))])}},{field:"harm_group2",label:u("routes.dashboard.dash.harmGroup",[2]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group2)==null?void 0:e.query)||!1,onClick:()=>F("harm_group2",266)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group2)==null?void 0:a.save)||!1,onClick:()=>E("harm_group2",266)},()=>u("sys.util.save"))])}},{field:"harm_group3",label:u("routes.dashboard.dash.harmGroup",[3]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group3)==null?void 0:e.query)||!1,onClick:()=>F("harm_group3",267)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group3)==null?void 0:a.save)||!1,onClick:()=>E("harm_group3",267)},()=>u("sys.util.save"))])}},{field:"harm_group4",label:u("routes.dashboard.dash.harmGroup",[4]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group4)==null?void 0:e.query)||!1,onClick:()=>F("harm_group4",268)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group4)==null?void 0:a.save)||!1,onClick:()=>E("harm_group4",268)},()=>u("sys.util.save"))])}},{field:"harm_group5",label:u("routes.dashboard.dash.harmGroup",[5]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group5)==null?void 0:e.query)||!1,onClick:()=>F("harm_group5",269)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group5)==null?void 0:a.save)||!1,onClick:()=>E("harm_group5",269)},()=>u("sys.util.save"))])}},{field:"harm_group6",label:u("routes.dashboard.dash.harmGroup",[6]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group6)==null?void 0:e.query)||!1,onClick:()=>F("harm_group6",270)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group6)==null?void 0:a.save)||!1,onClick:()=>E("harm_group6",270)},()=>u("sys.util.save"))])}},{field:"harm_group7",label:u("routes.dashboard.dash.harmGroup",[7]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group7)==null?void 0:e.query)||!1,onClick:()=>F("harm_group7",271)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group7)==null?void 0:a.save)||!1,onClick:()=>E("harm_group7",271)},()=>u("sys.util.save"))])}},{field:"harm_group8",label:u("routes.dashboard.dash.harmGroup",[8]),component:"InputNumber",rules:[{validator:I}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.harm_group8)==null?void 0:e.query)||!1,onClick:()=>F("harm_group8",272)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.harm_group8)==null?void 0:a.save)||!1,onClick:()=>E("harm_group8",272)},()=>u("sys.util.save"))])}}],Ge=["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"],je=["in_sample_pos","in_sample_dir","in_ct_ratio"],[Le,{setFieldsValue:le,validate:Ue,getFieldsValue:ve,resetFields:Ke}]=$({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:te.filter(e=>Ge.includes(e.field))}),[Je,{setFieldsValue:oe,validate:Xe,getFieldsValue:he,resetFields:Ye}]=$({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:te.filter(e=>je.includes(e.field))}),[Ze,{setFieldsValue:re,getFieldsValue:fe,validate:ea,resetFields:aa}]=$({labelWidth:220,baseColProps:{span:12},showActionButtonGroup:!1,schemas:te.filter(e=>e.field&&e.field.startsWith("harm_group"))}),ie=x(!1);function _e(){var e;eu({id:(e=N.value)==null?void 0:e.id}).then(a=>{var c;h.value=a.base,ae.value=((c=a.base)==null?void 0:c.warn)||{},ne.value=a.warn,Ke(),Ye(),aa(),Fa(),wa()})}function ua(){return D(this,null,function*(){var a;if(ie.value)return;ie.value=!0;const e=(a=h.value)==null?void 0:a.id;if(!!e)try{yield O({id:e,cmd:513,mode:"syn"}),yield new Promise(l=>setTimeout(l,1e3));const c=yield H({id:e});if((c==null?void 0:c.val)!==void 0&&c.val!==null){yield T(),yield new Promise(l=>setTimeout(l,200));try{j({comp_mode:Number(c.val)})}catch(l){}}yield O({id:e,cmd:512,mode:"syn"}),yield new Promise(l=>setTimeout(l,1e3));const o=yield H({id:e});if((o==null?void 0:o.val)!==void 0&&o.val!==null){yield T(),yield new Promise(l=>setTimeout(l,200));try{L({auto_enable:Number(o.val)})}catch(l){}}}catch(c){}})}Ra(()=>q.value,e=>D(this,null,function*(){String(e)==="4"?(X(!0),yield T(),yield new Promise(a=>setTimeout(a,500)),yield ua()):X(!1)})),Oa(()=>X(!1)),Na(()=>X(!1));const be=x(!1);function ye(){t.value.reload=!0,be.value=!0,setTimeout(()=>{be.value=!1,t.value.reload=!1},2e3),_e()}function sa(){const e=h.value;O({id:e.id,mode:"run"}).then(()=>{i.success(u("routes.dashboard.dash.cmdSuccess"))})}function ta(){const e=h.value;O({id:e.id,mode:"stp"}).then(()=>{i.success(u("routes.dashboard.dash.cmdSuccess"))})}function la(){const e=h.value;O({id:e.id,mode:"rst"}).then(()=>{i.success(u("routes.dashboard.dash.cmdSuccess"))})}function ge(e,a=3,c=200,o){return D(this,null,function*(){const l=yield H({id:e,addr:o}),n=l==null?void 0:l.val;yield new Promise(C=>setTimeout(C,100));const r=Date.now();for(let C=0;C<a;C++){const b=yield H({id:e,addr:o});if((b==null?void 0:b.val)!==void 0&&b.val!==null&&(n==null||b.val!==n||Date.now()-r>200||b.val===0&&C>=2))return b;C<a-1&&(yield new Promise(f=>setTimeout(f,c)))}return(yield H({id:e,addr:o}))||l})}function oa(){Ce()}function Ce(){return D(this,null,function*(){var a,c;const e=(a=h.value)==null?void 0:a.id;if(!!e){t.value.batchQueryCompAuto=!0;try{const o=yield Y({id:e,startAddr:512,count:2});if(!o||!o.taskId){i.error("\u63D0\u4EA4\u67E5\u8BE2\u5931\u8D25");return}const l=o.taskId;for(let n=0;n<10;n++){yield new Promise(v=>setTimeout(v,200));const r=yield Z({taskId:l});if(r.status==="completed"){const v=r.result,C=((c=v==null?void 0:v.data)==null?void 0:c.values)||(v==null?void 0:v.data)||(v==null?void 0:v.values)||v;if(C&&Array.isArray(C)&&C.length>=2){yield T();try{const b=Number(C[0]);let f=Number(C[1]);if(f>128){const y=f&255;(y&240)===128&&(f=f&65280|y&15)}L({auto_enable:b}),j({comp_mode:f}),setTimeout(()=>{const y=document.querySelector('[codefield="auto_enable"]'),P=document.querySelector('[codefield="comp_mode"]');if(y){y.setAttribute("formvalues",JSON.stringify({auto_enable:b}));const S=y.querySelector(".ant-select-selection-placeholder");S&&(S.textContent=b===1?"\u4F7F\u80FD":"\u4E0D\u4F7F\u80FD",S.style.color="#000")}if(P){P.setAttribute("formvalues",JSON.stringify({comp_mode:f}));const S=P.querySelector(".ant-select-selection-placeholder");S&&(S.textContent=f+" \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u65E0\u529F\u8865\u507F",S.style.color="#000")}},100),i.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}catch(b){i.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}}else i.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F");return}else if(r.status==="failed"){i.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25: "+(r.error||"\u672A\u77E5\u9519\u8BEF"));return}}i.warning("\u67E5\u8BE2\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5")}catch(o){i.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25")}finally{t.value.batchQueryCompAuto=!1}}})}function ra(){return D(this,null,function*(){var o,l,n;yield Promise.all([Ca(),Ba()]);const e=(o=Ee())==null?void 0:o.comp_mode,a=(l=De())==null?void 0:l.auto_enable,c=(n=h.value)==null?void 0:n.id;if(!!c){t.value.batchSaveCompAuto=!0;try{const r=[];a!=null&&a!==""&&r.push({addr:512,val:a}),e!=null&&e!==""&&r.push({addr:513,val:e}),r.length>0?(yield me({id:c,data:r,mode:"batch_save"}),yield new Promise(v=>setTimeout(v,800)),yield Ce(),i.success("\u6279\u91CF\u4FDD\u5B58\u6210\u529F\uFF0C\u5DF2\u81EA\u52A8\u8BFB\u53D6\u8BBE\u5907\u54CD\u5E94")):i.warning("\u6CA1\u6709\u9700\u8981\u4FDD\u5B58\u7684\u6570\u636E")}catch(r){i.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25")}finally{t.value.batchSaveCompAuto=!1}}})}function F(e,a){return D(this,null,function*(){var o;const c=(o=h.value)==null?void 0:o.id;if(!!c){t.value[e]||(t.value[e]={query:!1,save:!1}),t.value[e].query=!0;try{yield H({id:c,addr:a,clearOld:!0}),yield new Promise(n=>setTimeout(n,50)),yield O({id:c,cmd:a,mode:"syn"});const l=yield ge(c,50,200,a);if(!l||l.val===void 0||l.val===null){i.warning("\u67E5\u8BE2\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}if(l){let n=l.val;["in_ct_ratio","dev_ct_ratio"].includes(e)&&(n=n/10),yield T();try{if(["comp_mode"].includes(e))j({[e]:n});else if(["auto_enable"].includes(e))L({[e]:n});else if(["in_sample_pos","in_sample_dir","in_ct_ratio"].includes(e))oe({[e]:n});else if(["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"].includes(e))le({[e]:n});else if(e.startsWith("harm_group")){const r=typeof n=="string"&&n.includes(",")?n.split(",").map(Number):Number(n);re({[e]:r})}}catch(r){}}i.success(u("sys.util.querySuccess"))}catch(l){i.error(u("sys.util.queryFail"))}finally{t.value[e].query=!1}}})}function E(e,a){return D(this,null,function*(){var o;const c=(o=h.value)==null?void 0:o.id;if(!c){i.error("\u8BBE\u5907ID\u672A\u627E\u5230");return}t.value[e]||(t.value[e]={query:!1,save:!1}),t.value[e].save=!0;try{let l;if(["comp_mode"].includes(e)?l=Ee()[e]:["auto_enable"].includes(e)?l=De()[e]:["in_sample_pos","in_sample_dir","in_ct_ratio"].includes(e)?l=he()[e]:["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"].includes(e)?l=ve()[e]:e.startsWith("harm_group")&&(l=fe()[e]),l==null||l===""){i.error("\u8BF7\u5148\u8BBE\u7F6E\u53C2\u6570");return}["in_ct_ratio","dev_ct_ratio"].includes(e)&&(l=Math.round(Number(l)*10)),e.startsWith("harm_group")&&(l=Array.isArray(l)?l.join(","):l),e.startsWith("harm_group")||(l=Math.round(Number(l))),yield O({id:c,cmd:a,val:l,mode:"pam"}),yield new Promise(r=>setTimeout(r,500)),yield O({id:c,cmd:a,mode:"syn"});const n=yield ge(c,10,200,a);if(n&&n.val!==void 0&&n.val!==null){let r=n.val;["in_ct_ratio","dev_ct_ratio"].includes(e)&&(r=r/10),yield T();try{if(["comp_mode"].includes(e))j({[e]:r});else if(["auto_enable"].includes(e))L({[e]:r});else if(["in_sample_pos","in_sample_dir","in_ct_ratio"].includes(e))oe({[e]:r});else if(["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"].includes(e))le({[e]:r});else if(e.startsWith("harm_group")){const v=typeof r=="string"&&r.includes(",")?r.split(",").map(Number):Number(r);re({[e]:v})}i.success(`\u4FDD\u5B58\u6210\u529F\uFF0C\u8BBE\u5907\u54CD\u5E94\u503C: ${r}`)}catch(v){i.success("\u4FDD\u5B58\u6210\u529F")}}else i.success("\u4FDD\u5B58\u6210\u529F\uFF08\u672A\u6536\u5230\u8BBE\u5907\u54CD\u5E94\uFF0C\u8BF7\u624B\u52A8\u67E5\u8BE2\u9A8C\u8BC1\uFF09")}catch(l){i.error(`\u4FDD\u5B58\u5931\u8D25: ${l.message||l}`)}finally{t.value[e].save=!1}})}function ia(){return D(this,null,function*(){var a,c,o;const e=(a=h.value)==null?void 0:a.id;if(!!e){t.value.batchQueryOtherParams=!0;try{const l=yield Y({id:e,startAddr:13,count:5});if(!l||!l.taskId){i.error("\u63D0\u4EA4\u67E5\u8BE21\u5931\u8D25");return}const n=l.taskId;let r=null;for(let f=0;f<15;f++){yield new Promise(P=>setTimeout(P,500));const y=yield Z({taskId:n});if(y.status==="completed"){r=y.result;break}else if(y.status==="failed"){i.error("\u67E5\u8BE21\u5931\u8D25");return}}if(!r){i.warning("\u67E5\u8BE21\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}const v=yield Y({id:e,startAddr:241,count:2});if(!v||!v.taskId){i.error("\u63D0\u4EA4\u67E5\u8BE22\u5931\u8D25");return}const C=v.taskId;let b=null;for(let f=0;f<15;f++){yield new Promise(P=>setTimeout(P,500));const y=yield Z({taskId:C});if(y.status==="completed"){b=y.result;break}else if(y.status==="failed"){i.error("\u67E5\u8BE22\u5931\u8D25");return}}if(!b){i.warning("\u67E5\u8BE22\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}if(r&&r.data&&b&&b.data){const f=((c=r.data)==null?void 0:c.values)||r.data,y=((o=b.data)==null?void 0:o.values)||b.data;if(f.length>=5&&y.length>=2){const P={dev_sample_pos:f[0],dev_sample_dir:f[1],dev_sample_enable:f[3],dev_ct_ratio:y[1]/10},S={in_sample_dir:f[2],in_sample_pos:f[4],in_ct_ratio:y[0]/10};le(P),oe(S)}}i.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}catch(l){i.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25")}finally{t.value.batchQueryOtherParams=!1}}})}function na(){return D(this,null,function*(){var c;yield Promise.all([Ue(),Xe()]);const e=Q(Q({},ve()),he()),a=(c=h.value)==null?void 0:c.id;if(!!a){t.value.batchSaveOtherParams=!0;try{const o=[],l={dev_sample_pos:{addr:13},dev_sample_dir:{addr:14},in_sample_dir:{addr:15},dev_sample_enable:{addr:16},in_sample_pos:{addr:17},in_ct_ratio:{addr:241,scale:n=>Math.round(Number(n)*10)},dev_ct_ratio:{addr:242,scale:n=>Math.round(Number(n)*10)}};for(const[n,r]of Object.entries(l))if(n in e&&e[n]!==void 0&&e[n]!==null&&e[n]!==""){const v=r.scale?r.scale(e[n]):e[n];o.push({addr:r.addr,val:v})}o.length>0?(yield me({id:a,data:o,mode:"batch_save"}),i.success("\u6279\u91CF\u4FDD\u5B58\u6210\u529F")):i.warning("\u6CA1\u6709\u9700\u8981\u4FDD\u5B58\u7684\u6570\u636E")}catch(o){i.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25")}finally{t.value.batchSaveOtherParams=!1}}})}function ca(){return D(this,null,function*(){var a,c;const e=(a=h.value)==null?void 0:a.id;if(!!e){t.value.batchQueryHarmParams=!0;try{const o=yield Y({id:e,startAddr:265,count:8});if(!o||!o.taskId){i.error("\u63D0\u4EA4\u67E5\u8BE2\u5931\u8D25");return}const l=o.taskId;let n=null;for(let r=0;r<20;r++){yield new Promise(C=>setTimeout(C,500));const v=yield Z({taskId:l});if(v.status==="completed"){n=v.result;break}else if(v.status==="failed"){i.error("\u67E5\u8BE2\u5931\u8D25");return}}if(!n){i.warning("\u67E5\u8BE2\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}if(n&&n.data){const r=((c=n.data)==null?void 0:c.values)||n.data;if(r.length>=8){const v={harm_group1:r[0],harm_group2:r[1],harm_group3:r[2],harm_group4:r[3],harm_group5:r[4],harm_group6:r[5],harm_group7:r[6],harm_group8:r[7]};re(v);const C=[],b=["\u8C10\u6CE2\u7EC41(265)","\u8C10\u6CE2\u7EC42(266)","\u8C10\u6CE2\u7EC43(267)","\u8C10\u6CE2\u7EC44(268)","\u8C10\u6CE2\u7EC45(269)","\u8C10\u6CE2\u7EC46(270)","\u8C10\u6CE2\u7EC47(271)","\u8C10\u6CE2\u7EC48(272)"];r.forEach((f,y)=>{C.push(`${b[y]}: ${f}`)}),i.success(`\u6279\u91CF\u67E5\u8BE2\u6210\u529F\uFF01\u8C10\u6CE2\u7EC4\u53C2\u6570\u503C\uFF1A${C.join(", ")}`)}}else i.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}catch(o){i.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25")}finally{t.value.batchQueryHarmParams=!1}}})}function da(){return D(this,null,function*(){var c;yield ea();const e=fe(),a=(c=h.value)==null?void 0:c.id;if(!!a){t.value.batchSaveHarmParams=!0;try{const o=[],l={harm_group1:265,harm_group2:266,harm_group3:267,harm_group4:268,harm_group5:269,harm_group6:270,harm_group7:271,harm_group8:272};for(const[n,r]of Object.entries(l))if(n in e&&e[n]!==void 0&&e[n]!==null&&e[n]!==""){const v=Array.isArray(e[n])?e[n].join(","):e[n];o.push({addr:r,val:v})}o.length>0?(yield me({id:a,data:o,mode:"batch_save"}),i.success("\u6279\u91CF\u4FDD\u5B58\u6210\u529F")):i.warning("\u6CA1\u6709\u9700\u8981\u4FDD\u5B58\u7684\u6570\u636E")}catch(o){i.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25")}finally{t.value.batchSaveHarmParams=!1}}})}const ma=U(()=>[{title:u("sys.util.time"),dataIndex:"created",width:200},...ue.value.map(e=>({created:u("sys.util.time"),title:e.name,dataIndex:e.key}))]),V=x([Se(),Se()]),[pa,{reload:va,getRawDataSource:ha}]=Ne({api:au,beforeFetch(e){return Q({id:N.value.id,date:V.value},e)},afterFetch(){return ha().items.map(a=>Q({created:a.created},a.content))},maxHeight:700,columns:ma,bordered:!0});function fa(){return D(this,null,function*(){va()})}const[Fe,{openModal:_a}]=Za();function ba(){_a(!0,{name:N.value.name,feature:ue.value,record:{id:N.value.id,date:V.value}})}const ya=[{field:"comp_mode",label:u("routes.dashboard.dash.compMode"),component:"Select",componentProps:{options:[{label:"1 \u4E0D\u5E73\u8861\u8861",value:1},{label:"2 \u65E0\u529F\u529F\u8865\u507F",value:2},{label:"4 \u8C10\u6CE2\u7EC4",value:4},{label:"6 \u65E0\u529F\u529F+\u8C10\u6CE2\u7EC4\u8865\u507F",value:6},{label:"13 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:13},{label:"14 \u8C10\u6CE2\u7EC4+\u65E0\u529F\u529F\u8865\u507F",value:14},{label:"15 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u65E0\u529F\u529F\u8865\u507F",value:15},{label:"16 \u81EA\u8001\u5316\u53D1\u65E0\u529F\u529F",value:16},{label:"35 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:35},{label:"39 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8C10\u6CE2\u7EC4\u8865\u507F",value:39}]},required:!1,suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.comp_mode)==null?void 0:e.query)||!1,onClick:()=>F("comp_mode",513)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.comp_mode)==null?void 0:a.save)||!1,onClick:()=>E("comp_mode",513)},()=>u("sys.util.save"))])}}],[ga,{getFieldsValue:Ee,setFieldsValue:j,validate:Ca,resetFields:Fa}]=$({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:ya}),Ea=[{field:"auto_enable",label:u("routes.dashboard.dash.autoEnable"),component:"Select",componentProps:{options:[{label:u("routes.dashboard.dash.disable"),value:0},{label:u("routes.dashboard.dash.enable"),value:1}]},required:!1,suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=t.value.auto_enable)==null?void 0:e.query)||!1,onClick:()=>F("auto_enable",512)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=t.value.auto_enable)==null?void 0:a.save)||!1,onClick:()=>E("auto_enable",512)},()=>u("sys.util.save"))])}}],[Da,{getFieldsValue:De,setFieldsValue:L,validate:Ba,resetFields:wa}]=$({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:Ea}),ne=x([]),[ka]=Ne({dataSource:ne,maxHeight:700,columns:tu,bordered:!0});return(e,a)=>{const c=za("ModeSetting");return k(),xe(Pe,null,[p(s(Ya),Qa(e.$attrs,{onRegister:s(ee),width:"98%"}),{default:_(()=>[p(s(Ta),{activeKey:q.value,"onUpdate:activeKey":a[1]||(a[1]=o=>q.value=o)},{default:_(()=>[p(s(K),{key:"1",tab:s(u)("dev.info.base")},{default:_(()=>[g("div",ou,[p(s(Oe),{onRegister:s(W),class:"w-1/2"},{action:_(()=>[g("div",ru,[p(s(J),{title:s(u)("routes.dashboard.dash.start")},{default:_(()=>{var o;return[(o=se.value)!=null&&o.includes("run")?(k(),A(s(Ae),{key:0})):(k(),A(s(Ae),{style:{color:"#0960bd"},key:"on",onClick:sa}))]}),_:1},8,["title"]),p(s(J),{title:s(u)("routes.dashboard.dash.stop")},{default:_(()=>{var o;return[(o=se.value)!=null&&o.includes("stp")?(k(),A(s(qe),{key:0})):(k(),A(s(qe),{style:{color:"#0960bd"},key:"off",onClick:ta}))]}),_:1},8,["title"]),p(s(J),{title:s(u)("routes.dashboard.dash.reset")},{default:_(()=>{var o;return[(o=se.value)!=null&&o.includes("rst")?(k(),A(s(Ie),{key:0})):(k(),A(s(Ie),{style:{color:"#0960bd"},key:"reset",onClick:la}))]}),_:1},8,["title"])])]),_:1},8,["onRegister"]),p(s(Oe),{onRegister:s(Ve),class:"w-1/2"},null,8,["onRegister"])]),p(s(Ha),{size:"small",bordered:""},{title:_(()=>[g("div",iu,[g("div",nu,w(s(u)("dev.info.recentData")),1),g("div",cu,w(Qe.value),1),p(s(m),{type:"link",loading:t.value.reload,onClick:ye},{icon:_(()=>[t.value.reload?(k(),A(s(Wa),{key:1})):(k(),A(s(Ma),{key:0}))]),_:1},8,["loading"])])]),default:_(()=>[(k(!0),xe(Pe,null,Va(ue.value,(o,l)=>(k(),A(s($a),{label:o.name,key:l},{default:_(()=>[R(w(o.val)+" ",1),g("span",du,w(o.unit),1)]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["tab"]),p(s(K),{key:"2",tab:s(u)("dev.info.record")},{default:_(()=>[g("div",mu,[p(s(Ga),{value:V.value,"onUpdate:value":a[0]||(a[0]=o=>V.value=o)},null,8,["value"]),p(s(m),{class:"ml-2",onClick:fa,disabled:!V.value},{default:_(()=>[R(w(s(u)("sys.util.search")),1)]),_:1},8,["disabled"]),p(s(J),{class:"ml-2",title:s(u)("dev.info.chart")},{default:_(()=>[p(s(m),{type:"link",disabled:!V.value,onClick:ba},{default:_(()=>[p(s(ja))]),_:1},8,["disabled"])]),_:1},8,["title"])]),p(s(ze),{onRegister:s(pa)},null,8,["onRegister"])]),_:1},8,["tab"]),p(s(K),{key:"3",tab:s(u)("dev.info.warn")},{default:_(()=>[p(s(ze),{onRegister:s(ka)},null,8,["onRegister"])]),_:1},8,["tab"]),p(s(K),{key:"4"},{tab:_(()=>[g("span",null,w(s(u)("routes.dashboard.dash.setting")),1)]),default:_(()=>[g("div",pu,[g("div",vu,[p(s(La),{current:z.value,total:3,pageSize:1,simple:"",onChange:Te},null,8,["current"])]),ce(g("div",null,[g("div",hu,[p(s(G),{onRegister:s(ga)},null,8,["onRegister"]),p(s(G),{onRegister:s(Da)},null,8,["onRegister"])]),g("div",fu,[p(s(m),{type:"default",loading:t.value.batchQueryCompAuto,onClick:oa},{default:_(()=>[R(w(s(u)("sys.util.batchQuery")),1)]),_:1},8,["loading"]),p(s(m),{type:"default",loading:t.value.batchSaveCompAuto,onClick:ra},{default:_(()=>[R(w(s(u)("sys.util.batchSave")),1)]),_:1},8,["loading"])])],512),[[de,z.value===1]]),ce(g("div",null,[g("div",_u,[p(s(G),{onRegister:s(Le)},null,8,["onRegister"])]),g("div",bu,[p(s(G),{onRegister:s(Je)},null,8,["onRegister"])]),g("div",yu,[p(s(m),{type:"default",loading:t.value.batchQueryOtherParams,onClick:ia},{default:_(()=>[R(w(s(u)("sys.util.batchQuery")),1)]),_:1},8,["loading"]),p(s(m),{type:"default",loading:t.value.batchSaveOtherParams,onClick:na},{default:_(()=>[R(w(s(u)("sys.util.batchSave")),1)]),_:1},8,["loading"])])],512),[[de,z.value===2]]),ce(g("div",null,[g("div",gu,[p(s(G),{onRegister:s(Ze)},null,8,["onRegister"])]),g("div",Cu,[p(s(m),{type:"default",loading:t.value.batchQueryHarmParams,onClick:ca},{default:_(()=>[R(w(s(u)("sys.util.batchQuery")),1)]),_:1},8,["loading"]),p(s(m),{type:"default",loading:t.value.batchSaveHarmParams,onClick:da},{default:_(()=>[R(w(s(u)("sys.util.batchSave")),1)]),_:1},8,["loading"])])],512),[[de,z.value===3]])])]),_:1})]),_:1},8,["activeKey"])]),_:1},16,["onRegister"]),p(lu,{onRegister:s(Fe)},null,8,["onRegister"]),p(c,{onRegister:s(Fe),onSuccess:ye},null,8,["onRegister"])],64)}}});var is=Ka(Fu,[["__scopeId","data-v-768668dc"]]);export{is as default};
