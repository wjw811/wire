var Da=Object.defineProperty,Ba=Object.defineProperties;var wa=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var ka=Object.prototype.hasOwnProperty,xa=Object.prototype.propertyIsEnumerable;var we=(B,u,n)=>u in B?Da(B,u,{enumerable:!0,configurable:!0,writable:!0,value:n}):B[u]=n,T=(B,u)=>{for(var n in u||(u={}))ka.call(u,n)&&we(B,n,u[n]);if(Be)for(var n of Be(u))xa.call(u,n)&&we(B,n,u[n]);return B},ke=(B,u)=>Ba(B,wa(u));var D=(B,u,n)=>new Promise((P,R)=>{var o=S=>{try{M(n.next(S))}catch(_){R(_)}},ee=S=>{try{M(n.throw(S))}catch(_){R(_)}},M=S=>S.done?P(S.value):Promise.resolve(S.value).then(o,ee);M((n=n.apply(B,u)).next())});import{d as Pa,k as x,e as W,n as d,w as Sa,q as H,b as Aa,L as qa,a5 as Ia,$ as k,a0 as xe,f as p,a8 as f,u as t,a1 as y,a6 as I,a2 as w,F as Pe,ad as Ra,E as z,t as ce,A as de,a7 as Oa}from"./vue.5d40fadb.js";import{a8 as m,T as Se,av as za,b7 as G,U as J,ay as Ae,az as qe,au as Ie,b8 as Na,b9 as Va,aV as Qa,ba as Ta,bb as Ha,bc as $a,_ as Ma}from"./ui.83c3e48a.js";import{b as Wa,af as X,_ as Ga,h as ja}from"./index.a544321c.js";/* empty css               */import{u as Re,D as Oe}from"./index.c7f41dc0.js";import{j,B as L}from"./useForm.ecd151fb.js";/* empty css                */import{a as La,B as Ua}from"./index.8af6a699.js";import{u as Ka}from"./index.4d884b9c.js";import{i as Ja,h as Xa}from"./index.3523ca22.js";import{u as ze,B as Ne}from"./useTable.8740fd04.js";import{i as Ya,b as Za,w as eu}from"./index.data.b48e23c8.js";import{s as $,c as N,b as Y,a as Z,d as me}from"./index.4309479a.js";import au from"./chart.6e27c2e3.js";import"./utils.79519c03.js";/* empty css               *//* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css                *//* empty css                */import"./index.fa00f44b.js";import"./download.14b6de08.js";import"./index.03b81760.js";/* empty css               */import"./useWindowSizeFn.1ba172e7.js";import"./index.297fc3d1.js";/* empty css               *//* empty css                */import"./useContentViewHeight.ece959d0.js";import"./sortable.esm.045ad385.js";/* empty css                */import"./gateway.23d4013c.js";import"./data.f933c358.js";import"./useECharts.22ccf039.js";import"./charts.ac429643.js";const uu={class:"dashboard-container",style:{height:"calc(100vh - 120px)"}},su=["src"],tu={class:"flex gap-5"},lu={class:"flex items-center gap-4"},ou={class:"text-sm border-b border-[#d9d9d9] flex items-center"},ru={class:"py-3 pl-4"},iu={class:"px-3 text-xs font-normal text-gray-400"},nu={class:"text-gray-400"},cu={class:"flex"},du={class:"p-2"},mu={class:"flex justify-end mb-4"},pu={class:"param-form-container"},vu={class:"mt-4 text-right space-x-2"},hu={class:"param-form-container"},fu={class:"param-form-container"},_u={class:"mt-4 text-right space-x-2"},bu={class:"param-form-container"},yu={class:"mt-4 text-right space-x-2"},gu=Pa({__name:"info",setup(B){const{t:u}=Wa(),{createMessage:n}=ja(),P=x({}),R=x("1"),o=x({batchQueryCompAuto:!1,batchSaveCompAuto:!1,batchQueryOtherParams:!1,batchSaveOtherParams:!1,batchQueryHarmParams:!1,batchSaveHarmParams:!1,reload:!1}),[ee,{setDrawerProps:M}]=La(e=>D(this,null,function*(){_.value=[],ae.value=[],ne.value=[],ie.value=!1,V.value=1,o.value={batchQueryCompAuto:!1,batchSaveCompAuto:!1,batchQueryOtherParams:!1,batchSaveOtherParams:!1,batchQueryHarmParams:!1,batchSaveHarmParams:!1,reload:!1},P.value=e==null?void 0:e.record,M({confirmLoading:!1,title:u("dev.info.title")+"-"+e.record.name}),_e(),(e==null?void 0:e.openParam)===!0?R.value="4":R.value="0"})),S=W(()=>{var i,s;const e=((i=P.value)==null?void 0:i.serial)||"1",a=((s=P.value)==null?void 0:s.id)||"";return`/static/standalone-server/_runtime/device_direct.html?serial=${e}&id=${a}&mode=server`}),_=x({}),[Ve]=Re({title:u("dev.info.title"),data:_,column:1,schema:Ya}),ae=x([]),[Qe]=Re({title:u("dev.info.recentWarn"),data:ae,column:1,schema:Za}),ue=W(()=>{var i,s;const e=((i=_.value)==null?void 0:i.feature)||[],a=((s=_.value)==null?void 0:s.history)||{};return e.map(l=>ke(T({},l),{val:(a==null?void 0:a.content[l.key])!==void 0?a==null?void 0:a.content[l.key]:"-"}))}),Te=W(()=>{var a;return(((a=_.value)==null?void 0:a.history)||{}).created}),se=W(()=>{var a,i;return((i=(((a=_.value)==null?void 0:a.history)||{}).content)==null?void 0:i.limit)||["run","stp","rst"]}),V=x(1);function He(e){V.value=e}const pe=[{label:u("routes.dashboard.dash.disable"),value:0},{label:u("routes.dashboard.dash.enable"),value:1}],$e=[{label:u("routes.dashboard.dash.outflow"),value:0},{label:u("routes.dashboard.dash.inflow"),value:1}],Me=[{label:u("routes.dashboard.dash.outflow"),value:0},{label:u("routes.dashboard.dash.inflow"),value:1}],We=[{label:u("routes.dashboard.dash.cabinet"),value:0},{label:u("routes.dashboard.dash.capacitor"),value:1}],Ge=[{label:u("routes.dashboard.dash.cabinet"),value:0},{label:u("routes.dashboard.dash.capacitor"),value:1}];function O(e,a){if(a==null||a==="")return Promise.resolve();const i=Number(a);return Number.isNaN(i)?Promise.reject(u("routes.dashboard.dash.inputNumber")):i===0||i>=2&&i<=50?Promise.resolve():Promise.reject(u("routes.dashboard.dash.allowRange"))}const te=[{field:"auto_enable",label:u("routes.dashboard.dash.autoEnable"),component:"Select",componentProps:{options:pe}},{field:"comp_mode",label:u("routes.dashboard.dash.compMode"),component:"Select",componentProps:{options:[{label:"1 \u4E0D\u5E73\u8861\u8861",value:1},{label:"2 \u65E0\u529F\u529F\u8865\u507F",value:2},{label:"4 \u8C10\u6CE2\u7EC4",value:4},{label:"6 \u65E0\u529F\u529F+\u8C10\u6CE2\u7EC4\u8865\u507F",value:6},{label:"13 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:13},{label:"14 \u8C10\u6CE2\u7EC4+\u65E0\u529F\u529F\u8865\u507F",value:14},{label:"15 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u65E0\u529F\u529F\u8865\u507F",value:15},{label:"16 \u81EA\u8001\u5316\u53D1\u65E0\u529F\u529F",value:16},{label:"35 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:35},{label:"39 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8C10\u6CE2\u7EC4\u8865\u507F",value:39}]}},{field:"in_sample_pos",label:u("routes.dashboard.dash.inSamplePos"),component:"Select",componentProps:{options:We},suffix:()=>{var e;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:!1,onClick:()=>F("in_sample_pos",17)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((e=o.value.in_sample_pos)==null?void 0:e.save)||!1,onClick:()=>E("in_sample_pos",17)},()=>u("sys.util.save"))])}},{field:"in_sample_dir",label:u("routes.dashboard.dash.inSampleDir"),component:"Select",componentProps:{options:$e},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.in_sample_dir)==null?void 0:e.query)||!1,onClick:()=>F("in_sample_dir",15)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.in_sample_dir)==null?void 0:a.save)||!1,onClick:()=>E("in_sample_dir",15)},()=>u("sys.util.save"))])}},{field:"in_ct_ratio",label:u("routes.dashboard.dash.inCtRatio"),component:"InputNumber",componentProps:{min:1,max:1e4,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.in_ct_ratio)==null?void 0:e.query)||!1,onClick:()=>F("in_ct_ratio",241)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.in_ct_ratio)==null?void 0:a.save)||!1,onClick:()=>E("in_ct_ratio",241)},()=>u("sys.util.save"))])}},{field:"dev_sample_enable",label:u("routes.dashboard.dash.devSampleEnable"),component:"Select",componentProps:{options:pe},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.dev_sample_enable)==null?void 0:e.query)||!1,onClick:()=>F("dev_sample_enable",16)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.dev_sample_enable)==null?void 0:a.save)||!1,onClick:()=>E("dev_sample_enable",16)},()=>u("sys.util.save"))])}},{field:"dev_sample_pos",label:u("routes.dashboard.dash.devSamplePos"),component:"Select",componentProps:{options:Ge},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.dev_sample_pos)==null?void 0:e.query)||!1,onClick:()=>F("dev_sample_pos",13)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.dev_sample_pos)==null?void 0:a.save)||!1,onClick:()=>E("dev_sample_pos",13)},()=>u("sys.util.save"))])}},{field:"dev_sample_dir",label:u("routes.dashboard.dash.devSampleDir"),component:"Select",componentProps:{options:Me},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.dev_sample_dir)==null?void 0:e.query)||!1,onClick:()=>F("dev_sample_dir",14)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.dev_sample_dir)==null?void 0:a.save)||!1,onClick:()=>E("dev_sample_dir",14)},()=>u("sys.util.save"))])}},{field:"dev_ct_ratio",label:u("routes.dashboard.dash.devCtRatio"),component:"InputNumber",componentProps:{min:1,max:1e4,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.dev_ct_ratio)==null?void 0:e.query)||!1,onClick:()=>F("dev_ct_ratio",242)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.dev_ct_ratio)==null?void 0:a.save)||!1,onClick:()=>E("dev_ct_ratio",242)},()=>u("sys.util.save"))])}},{field:"harm_group1",label:u("routes.dashboard.dash.harmGroup",[1]),component:"InputNumber",rules:[{validator:O}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.harm_group1)==null?void 0:e.query)||!1,onClick:()=>F("harm_group1",265)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.harm_group1)==null?void 0:a.save)||!1,onClick:()=>E("harm_group1",265)},()=>u("sys.util.save"))])}},{field:"harm_group2",label:u("routes.dashboard.dash.harmGroup",[2]),component:"InputNumber",rules:[{validator:O}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.harm_group2)==null?void 0:e.query)||!1,onClick:()=>F("harm_group2",266)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.harm_group2)==null?void 0:a.save)||!1,onClick:()=>E("harm_group2",266)},()=>u("sys.util.save"))])}},{field:"harm_group3",label:u("routes.dashboard.dash.harmGroup",[3]),component:"InputNumber",rules:[{validator:O}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.harm_group3)==null?void 0:e.query)||!1,onClick:()=>F("harm_group3",267)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.harm_group3)==null?void 0:a.save)||!1,onClick:()=>E("harm_group3",267)},()=>u("sys.util.save"))])}},{field:"harm_group4",label:u("routes.dashboard.dash.harmGroup",[4]),component:"InputNumber",rules:[{validator:O}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.harm_group4)==null?void 0:e.query)||!1,onClick:()=>F("harm_group4",268)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.harm_group4)==null?void 0:a.save)||!1,onClick:()=>E("harm_group4",268)},()=>u("sys.util.save"))])}},{field:"harm_group5",label:u("routes.dashboard.dash.harmGroup",[5]),component:"InputNumber",rules:[{validator:O}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.harm_group5)==null?void 0:e.query)||!1,onClick:()=>F("harm_group5",269)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.harm_group5)==null?void 0:a.save)||!1,onClick:()=>E("harm_group5",269)},()=>u("sys.util.save"))])}},{field:"harm_group6",label:u("routes.dashboard.dash.harmGroup",[6]),component:"InputNumber",rules:[{validator:O}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.harm_group6)==null?void 0:e.query)||!1,onClick:()=>F("harm_group6",270)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.harm_group6)==null?void 0:a.save)||!1,onClick:()=>E("harm_group6",270)},()=>u("sys.util.save"))])}},{field:"harm_group7",label:u("routes.dashboard.dash.harmGroup",[7]),component:"InputNumber",rules:[{validator:O}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.harm_group7)==null?void 0:e.query)||!1,onClick:()=>F("harm_group7",271)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.harm_group7)==null?void 0:a.save)||!1,onClick:()=>E("harm_group7",271)},()=>u("sys.util.save"))])}},{field:"harm_group8",label:u("routes.dashboard.dash.harmGroup",[8]),component:"InputNumber",rules:[{validator:O}],componentProps:{min:0,max:50,precision:0},suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.harm_group8)==null?void 0:e.query)||!1,onClick:()=>F("harm_group8",272)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.harm_group8)==null?void 0:a.save)||!1,onClick:()=>E("harm_group8",272)},()=>u("sys.util.save"))])}}],je=["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"],Le=["in_sample_pos","in_sample_dir","in_ct_ratio"],[Ue,{setFieldsValue:le,validate:Ke,getFieldsValue:ve,resetFields:Cu}]=j({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:te.filter(e=>je.includes(e.field))}),[Je,{setFieldsValue:oe,validate:Xe,getFieldsValue:he,resetFields:Fu}]=j({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:te.filter(e=>Le.includes(e.field))}),[Ye,{setFieldsValue:re,getFieldsValue:fe,validate:Ze,resetFields:Eu}]=j({labelWidth:220,baseColProps:{span:12},showActionButtonGroup:!1,schemas:te.filter(e=>e.field&&e.field.startsWith("harm_group"))}),ie=x(!1);function _e(){var a;const e=(a=P.value)==null?void 0:a.id;!e||Ja({id:e}).then(i=>{var s;i&&i.base?(_.value=i.base,ae.value=((s=i.base)==null?void 0:s.warn)||{},ne.value=i.warn||[]):n.error(u("dev.info.notFound")||"\u8BBE\u5907\u4FE1\u606F\u672A\u627E\u5230")}).catch(i=>{console.error("infoApi error:",i)})}function ea(){return D(this,null,function*(){var a;if(ie.value)return;ie.value=!0;const e=(a=_.value)==null?void 0:a.id;if(!!e)try{yield N({id:e,cmd:513,mode:"syn"}),yield new Promise(l=>setTimeout(l,1e3));const i=yield $({id:e});if((i==null?void 0:i.val)!==void 0&&i.val!==null){yield H(),yield new Promise(l=>setTimeout(l,200));try{U({comp_mode:Number(i.val)})}catch(l){console.warn("\u8BBE\u7F6E\u8865\u507F\u6A21\u5F0F\u5931\u8D25:",l)}}yield N({id:e,cmd:512,mode:"syn"}),yield new Promise(l=>setTimeout(l,1e3));const s=yield $({id:e});if((s==null?void 0:s.val)!==void 0&&s.val!==null){yield H(),yield new Promise(l=>setTimeout(l,200));try{K({auto_enable:Number(s.val)})}catch(l){console.warn("\u8BBE\u7F6E\u81EA\u542F\u52A8\u5931\u8D25",l)}}}catch(i){console.warn("\u81EA\u52A8\u67E5\u8BE2\u53C2\u6570\u5931\u8D25:",i)}})}Sa(()=>R.value,e=>D(this,null,function*(){String(e)==="4"?(X(!0),yield H(),yield new Promise(a=>setTimeout(a,500)),yield ea()):X(!1)})),Aa(()=>X(!1)),qa(()=>X(!1));const be=x(!1);function ye(){o.value.reload=!0,be.value=!0,setTimeout(()=>{be.value=!1,o.value.reload=!1},2e3),_e()}function aa(){const e=_.value;N({id:e.id,mode:"run"}).then(()=>{n.success(u("routes.dashboard.dash.cmdSuccess"))})}function ua(){const e=_.value;N({id:e.id,mode:"stp"}).then(()=>{n.success(u("routes.dashboard.dash.cmdSuccess"))})}function sa(){const e=_.value;N({id:e.id,mode:"rst"}).then(()=>{n.success(u("routes.dashboard.dash.cmdSuccess"))})}function ge(e,a=3,i=200,s){return D(this,null,function*(){const l=yield $({id:e,addr:s}),c=l==null?void 0:l.val;yield new Promise(C=>setTimeout(C,100));const r=Date.now();for(let C=0;C<a;C++){const b=yield $({id:e,addr:s});if((b==null?void 0:b.val)!==void 0&&b.val!==null&&(c==null||b.val!==c||Date.now()-r>200||b.val===0&&C>=2))return b;C<a-1&&(yield new Promise(h=>setTimeout(h,i)))}return(yield $({id:e,addr:s}))||l})}function ta(){Ce()}function Ce(){return D(this,null,function*(){var a,i;const e=(a=_.value)==null?void 0:a.id;if(!!e){o.value.batchQueryCompAuto=!0;try{const s=yield Y({id:e,startAddr:512,count:2});if(!s||!s.taskId){n.error("\u63D0\u4EA4\u67E5\u8BE2\u5931\u8D25");return}const l=s.taskId;for(let c=0;c<10;c++){yield new Promise(v=>setTimeout(v,200));const r=yield Z({taskId:l});if(r.status==="completed"){const v=r.result,C=((i=v==null?void 0:v.data)==null?void 0:i.values)||(v==null?void 0:v.data)||(v==null?void 0:v.values)||v;if(C&&Array.isArray(C)&&C.length>=2){yield H();try{const b=Number(C[0]);let h=Number(C[1]);if(h>128){const g=h&255;(g&240)===128&&(h=h&65280|g&15)}K({auto_enable:b}),U({comp_mode:h}),setTimeout(()=>{const g=document.querySelector('[codefield="auto_enable"]'),A=document.querySelector('[codefield="comp_mode"]');if(g){g.setAttribute("formvalues",JSON.stringify({auto_enable:b}));const q=g.querySelector(".ant-select-selection-placeholder");q&&(q.textContent=b===1?"\u4F7F\u80FD":"\u4E0D\u4F7F\u80FD",q.style.color="#000")}if(A){A.setAttribute("formvalues",JSON.stringify({comp_mode:h}));const q=A.querySelector(".ant-select-selection-placeholder");q&&(q.textContent=h+" \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u65E0\u529F\u8865\u507F",q.style.color="#000")}},100),n.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}catch(b){console.warn("\u8BBE\u7F6E\u53C2\u6570\u5931\u8D25:",b),n.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}}else n.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F");return}else if(r.status==="failed"){n.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25: "+(r.error||"\u672A\u77E5\u9519\u8BEF"));return}}n.warning("\u67E5\u8BE2\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5")}catch(s){console.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25:",s),n.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25")}finally{o.value.batchQueryCompAuto=!1}}})}function la(){return D(this,null,function*(){var s,l,c;yield Promise.all([ya(),Fa()]);const e=(s=Ee())==null?void 0:s.comp_mode,a=(l=De())==null?void 0:l.auto_enable,i=(c=_.value)==null?void 0:c.id;if(!!i){o.value.batchSaveCompAuto=!0;try{const r=[];a!=null&&a!==""&&r.push({addr:512,val:a}),e!=null&&e!==""&&r.push({addr:513,val:e}),r.length>0?(yield me({id:i,data:r,mode:"batch_save"}),console.log("[handleBatchSaveCompAuto] \u6279\u91CF\u4FDD\u5B58\u6210\u529F\uFF0C\u6B63\u5728\u8BFB\u53D6\u8BBE\u5907\u54CD\u5E94..."),yield new Promise(v=>setTimeout(v,800)),yield Ce(),n.success("\u6279\u91CF\u4FDD\u5B58\u6210\u529F\uFF0C\u5DF2\u81EA\u52A8\u8BFB\u53D6\u8BBE\u5907\u54CD\u5E94")):n.warning("\u6CA1\u6709\u9700\u8981\u4FDD\u5B58\u7684\u6570\u636E")}catch(r){console.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25:",r),n.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25")}finally{o.value.batchSaveCompAuto=!1}}})}function F(e,a){return D(this,null,function*(){var s;const i=(s=_.value)==null?void 0:s.id;if(!!i){o.value[e]||(o.value[e]={query:!1,save:!1}),o.value[e].query=!0;try{yield $({id:i,addr:a,clearOld:!0}),yield new Promise(c=>setTimeout(c,50)),yield N({id:i,cmd:a,mode:"syn"});const l=yield ge(i,50,200,a);if(!l||l.val===void 0||l.val===null){n.warning("\u67E5\u8BE2\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}if(l){let c=l.val;["in_ct_ratio","dev_ct_ratio"].includes(e)&&(c=c/10),yield H();try{if(["comp_mode"].includes(e))U({[e]:c});else if(["auto_enable"].includes(e))K({[e]:c});else if(["in_sample_pos","in_sample_dir","in_ct_ratio"].includes(e))oe({[e]:c});else if(["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"].includes(e))le({[e]:c});else if(e.startsWith("harm_group")){const r=typeof c=="string"&&c.includes(",")?c.split(",").map(Number):Number(c);re({[e]:r})}}catch(r){console.warn(`\u8BBE\u7F6E\u53C2\u6570 ${e} \u5931\u8D25:`,r)}}n.success(u("sys.util.querySuccess"))}catch(l){n.error(u("sys.util.queryFail"))}finally{o.value[e].query=!1}}})}function E(e,a){return D(this,null,function*(){var s;const i=(s=_.value)==null?void 0:s.id;if(!i){n.error("\u8BBE\u5907ID\u672A\u627E\u5230");return}o.value[e]||(o.value[e]={query:!1,save:!1}),o.value[e].save=!0;try{let l;if(["comp_mode"].includes(e)?l=Ee()[e]:["auto_enable"].includes(e)?l=De()[e]:["in_sample_pos","in_sample_dir","in_ct_ratio"].includes(e)?l=he()[e]:["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"].includes(e)?l=ve()[e]:e.startsWith("harm_group")&&(l=fe()[e]),l==null||l===""){n.error("\u8BF7\u5148\u8BBE\u7F6E\u53C2\u6570");return}["in_ct_ratio","dev_ct_ratio"].includes(e)&&(l=Math.round(Number(l)*10)),e.startsWith("harm_group")&&(l=Array.isArray(l)?l.join(","):l),e.startsWith("harm_group")||(l=Math.round(Number(l))),console.log(`[handleSaveSingle] \u4FDD\u5B58\u53C2\u6570: field=${e}, funcCode=${a}, val=${l}, id=${i}`),yield N({id:i,cmd:a,val:l,mode:"pam"}),console.log("[handleSaveSingle] \u4E0B\u53D1\u6210\u529F\uFF0C\u6B63\u5728\u8BFB\u53D6\u8BBE\u5907\u54CD\u5E94..."),yield new Promise(r=>setTimeout(r,500)),yield N({id:i,cmd:a,mode:"syn"});const c=yield ge(i,10,200,a);if(c&&c.val!==void 0&&c.val!==null){let r=c.val;["in_ct_ratio","dev_ct_ratio"].includes(e)&&(r=r/10),console.log(`[handleSaveSingle] \u6536\u5230\u8BBE\u5907\u54CD\u5E94: ${r}`),yield H();try{if(["comp_mode"].includes(e))U({[e]:r});else if(["auto_enable"].includes(e))K({[e]:r});else if(["in_sample_pos","in_sample_dir","in_ct_ratio"].includes(e))oe({[e]:r});else if(["dev_sample_enable","dev_sample_pos","dev_sample_dir","dev_ct_ratio"].includes(e))le({[e]:r});else if(e.startsWith("harm_group")){const v=typeof r=="string"&&r.includes(",")?r.split(",").map(Number):Number(r);re({[e]:v})}n.success(`\u4FDD\u5B58\u6210\u529F\uFF0C\u8BBE\u5907\u54CD\u5E94\u503C: ${r}`)}catch(v){console.warn(`\u66F4\u65B0\u53C2\u6570 ${e} \u5931\u8D25:`,v),n.success("\u4FDD\u5B58\u6210\u529F")}}else console.warn("[handleSaveSingle] \u672A\u6536\u5230\u8BBE\u5907\u54CD\u5E94"),n.success("\u4FDD\u5B58\u6210\u529F\uFF08\u672A\u6536\u5230\u8BBE\u5907\u54CD\u5E94\uFF0C\u8BF7\u624B\u52A8\u67E5\u8BE2\u9A8C\u8BC1\uFF09")}catch(l){console.error("[handleSaveSingle] \u4FDD\u5B58\u5931\u8D25:",l),n.error(`\u4FDD\u5B58\u5931\u8D25: ${l.message||l}`)}finally{o.value[e].save=!1}})}function oa(){return D(this,null,function*(){var a,i,s;const e=(a=_.value)==null?void 0:a.id;if(!!e){o.value.batchQueryOtherParams=!0;try{const l=yield Y({id:e,startAddr:13,count:5});if(!l||!l.taskId){n.error("\u63D0\u4EA4\u67E5\u8BE21\u5931\u8D25");return}const c=l.taskId;let r=null;for(let h=0;h<15;h++){yield new Promise(A=>setTimeout(A,500));const g=yield Z({taskId:c});if(g.status==="completed"){r=g.result;break}else if(g.status==="failed"){n.error("\u67E5\u8BE21\u5931\u8D25");return}}if(!r){n.warning("\u67E5\u8BE21\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}const v=yield Y({id:e,startAddr:241,count:2});if(!v||!v.taskId){n.error("\u63D0\u4EA4\u67E5\u8BE22\u5931\u8D25");return}const C=v.taskId;let b=null;for(let h=0;h<15;h++){yield new Promise(A=>setTimeout(A,500));const g=yield Z({taskId:C});if(g.status==="completed"){b=g.result;break}else if(g.status==="failed"){n.error("\u67E5\u8BE22\u5931\u8D25");return}}if(!b){n.warning("\u67E5\u8BE22\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}if(r&&r.data&&b&&b.data){const h=((i=r.data)==null?void 0:i.values)||r.data,g=((s=b.data)==null?void 0:s.values)||b.data;if(h.length>=5&&g.length>=2){const A={dev_sample_pos:h[0],dev_sample_dir:h[1],dev_sample_enable:h[3],dev_ct_ratio:g[1]/10},q={in_sample_dir:h[2],in_sample_pos:h[4],in_ct_ratio:g[0]/10};le(A),oe(q)}}n.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}catch(l){console.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25:",l),n.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25")}finally{o.value.batchQueryOtherParams=!1}}})}function ra(){return D(this,null,function*(){var i;yield Promise.all([Ke(),Xe()]);const e=T(T({},ve()),he()),a=(i=_.value)==null?void 0:i.id;if(!!a){o.value.batchSaveOtherParams=!0;try{const s=[],l={dev_sample_pos:{addr:13},dev_sample_dir:{addr:14},in_sample_dir:{addr:15},dev_sample_enable:{addr:16},in_sample_pos:{addr:17},in_ct_ratio:{addr:241,scale:c=>Math.round(Number(c)*10)},dev_ct_ratio:{addr:242,scale:c=>Math.round(Number(c)*10)}};for(const[c,r]of Object.entries(l))if(c in e&&e[c]!==void 0&&e[c]!==null&&e[c]!==""){const v=r.scale?r.scale(e[c]):e[c];s.push({addr:r.addr,val:v})}s.length>0?(yield me({id:a,data:s,mode:"batch_save"}),n.success("\u6279\u91CF\u4FDD\u5B58\u6210\u529F")):n.warning("\u6CA1\u6709\u9700\u8981\u4FDD\u5B58\u7684\u6570\u636E")}catch(s){console.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25:",s),n.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25")}finally{o.value.batchSaveOtherParams=!1}}})}function ia(){return D(this,null,function*(){var a,i;const e=(a=_.value)==null?void 0:a.id;if(!!e){o.value.batchQueryHarmParams=!0;try{const s=yield Y({id:e,startAddr:265,count:8});if(!s||!s.taskId){n.error("\u63D0\u4EA4\u67E5\u8BE2\u5931\u8D25");return}const l=s.taskId;let c=null;for(let r=0;r<20;r++){yield new Promise(C=>setTimeout(C,500));const v=yield Z({taskId:l});if(v.status==="completed"){c=v.result;break}else if(v.status==="failed"){n.error("\u67E5\u8BE2\u5931\u8D25");return}}if(!c){n.warning("\u67E5\u8BE2\u8D85\u65F6\uFF0C\u8BF7\u91CD\u8BD5");return}if(c&&c.data){const r=((i=c.data)==null?void 0:i.values)||c.data;if(r.length>=8){const v={harm_group1:r[0],harm_group2:r[1],harm_group3:r[2],harm_group4:r[3],harm_group5:r[4],harm_group6:r[5],harm_group7:r[6],harm_group8:r[7]};re(v);const C=[],b=["\u8C10\u6CE2\u7EC41(265)","\u8C10\u6CE2\u7EC42(266)","\u8C10\u6CE2\u7EC43(267)","\u8C10\u6CE2\u7EC44(268)","\u8C10\u6CE2\u7EC45(269)","\u8C10\u6CE2\u7EC46(270)","\u8C10\u6CE2\u7EC47(271)","\u8C10\u6CE2\u7EC48(272)"];r.forEach((h,g)=>{C.push(`${b[g]}: ${h}`)}),n.success(`\u6279\u91CF\u67E5\u8BE2\u6210\u529F\uFF01\u8C10\u6CE2\u7EC4\u53C2\u6570\u503C\uFF1A${C.join(", ")}`)}}else n.success("\u6279\u91CF\u67E5\u8BE2\u6210\u529F")}catch(s){console.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25:",s),n.error("\u6279\u91CF\u67E5\u8BE2\u5931\u8D25")}finally{o.value.batchQueryHarmParams=!1}}})}function na(){return D(this,null,function*(){var i;yield Ze();const e=fe(),a=(i=_.value)==null?void 0:i.id;if(!!a){o.value.batchSaveHarmParams=!0;try{const s=[],l={harm_group1:265,harm_group2:266,harm_group3:267,harm_group4:268,harm_group5:269,harm_group6:270,harm_group7:271,harm_group8:272};for(const[c,r]of Object.entries(l))if(c in e&&e[c]!==void 0&&e[c]!==null&&e[c]!==""){const v=Array.isArray(e[c])?e[c].join(","):e[c];s.push({addr:r,val:v})}s.length>0?(yield me({id:a,data:s,mode:"batch_save"}),n.success("\u6279\u91CF\u4FDD\u5B58\u6210\u529F")):n.warning("\u6CA1\u6709\u9700\u8981\u4FDD\u5B58\u7684\u6570\u636E")}catch(s){console.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25:",s),n.error("\u6279\u91CF\u4FDD\u5B58\u5931\u8D25")}finally{o.value.batchSaveHarmParams=!1}}})}const ca=W(()=>[{title:u("sys.util.time"),dataIndex:"created",width:200},...ue.value.map(e=>({created:u("sys.util.time"),title:e.name,dataIndex:e.key}))]),Q=x([Se(),Se()]),[da,{reload:ma,getRawDataSource:pa}]=ze({api:Xa,beforeFetch(e){return T({id:P.value.id,date:Q.value},e)},afterFetch(){return pa().items.map(a=>T({created:a.created},a.content))},maxHeight:700,columns:ca,bordered:!0});function va(){return D(this,null,function*(){ma()})}const[Fe,{openModal:ha}]=Ka();function fa(){ha(!0,{name:P.value.name,feature:ue.value,record:{id:P.value.id,date:Q.value}})}const _a=[{field:"comp_mode",label:u("routes.dashboard.dash.compMode"),component:"Select",componentProps:{options:[{label:"1 \u4E0D\u5E73\u8861\u8861",value:1},{label:"2 \u65E0\u529F\u529F\u8865\u507F",value:2},{label:"4 \u8C10\u6CE2\u7EC4",value:4},{label:"6 \u65E0\u529F\u529F+\u8C10\u6CE2\u7EC4\u8865\u507F",value:6},{label:"13 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:13},{label:"14 \u8C10\u6CE2\u7EC4+\u65E0\u529F\u529F\u8865\u507F",value:14},{label:"15 \u8C10\u6CE2\u7EC4+\u4E0D\u5E73\u8861\u8861\u65E0\u529F\u529F\u8865\u507F",value:15},{label:"16 \u81EA\u8001\u5316\u53D1\u65E0\u529F\u529F",value:16},{label:"35 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8865\u507F",value:35},{label:"39 \u65E0\u529F\u529F+\u4E0D\u5E73\u8861\u8861\u8C10\u6CE2\u7EC4\u8865\u507F",value:39}]},required:!1,suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.comp_mode)==null?void 0:e.query)||!1,onClick:()=>F("comp_mode",513)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.comp_mode)==null?void 0:a.save)||!1,onClick:()=>E("comp_mode",513)},()=>u("sys.util.save"))])}}],[ba,{getFieldsValue:Ee,setFieldsValue:U,validate:ya,resetFields:Du}]=j({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:_a}),ga=[{field:"auto_enable",label:u("routes.dashboard.dash.autoEnable"),component:"Select",componentProps:{options:[{label:u("routes.dashboard.dash.disable"),value:0},{label:u("routes.dashboard.dash.enable"),value:1}]},required:!1,suffix:()=>{var e,a;return d("div",{class:"flex space-x-1"},[d(m,{size:"small",loading:((e=o.value.auto_enable)==null?void 0:e.query)||!1,onClick:()=>F("auto_enable",512)},()=>u("sys.util.query")),d(m,{size:"small",type:"primary",loading:((a=o.value.auto_enable)==null?void 0:a.save)||!1,onClick:()=>E("auto_enable",512)},()=>u("sys.util.save"))])}}],[Ca,{getFieldsValue:De,setFieldsValue:K,validate:Fa,resetFields:Bu}]=j({labelWidth:220,baseColProps:{span:24},showActionButtonGroup:!1,schemas:ga}),ne=x([]),[Ea]=ze({dataSource:ne,maxHeight:700,columns:eu,bordered:!0});return(e,a)=>{const i=Ia("ModeSetting");return k(),xe(Pe,null,[p(t(Ua),Oa(e.$attrs,{onRegister:t(ee),width:"98%"}),{default:f(()=>[p(t(za),{activeKey:R.value,"onUpdate:activeKey":a[1]||(a[1]=s=>R.value=s)},{default:f(()=>[p(t(G),{key:"0",tab:t(u)("dev.info.dashboard")},{default:f(()=>[y("div",uu,[y("iframe",{src:S.value,width:"100%",height:"100%",frameborder:"0"},null,8,su)])]),_:1},8,["tab"]),p(t(G),{key:"1",tab:t(u)("dev.info.base")},{default:f(()=>[y("div",tu,[p(t(Oe),{onRegister:t(Ve),class:"w-1/2"},{action:f(()=>[y("div",lu,[p(t(J),{title:t(u)("routes.dashboard.dash.start")},{default:f(()=>{var s;return[(s=se.value)!=null&&s.includes("run")?(k(),I(t(Ae),{key:0})):(k(),I(t(Ae),{style:{color:"#0960bd"},key:"on",onClick:aa}))]}),_:1},8,["title"]),p(t(J),{title:t(u)("routes.dashboard.dash.stop")},{default:f(()=>{var s;return[(s=se.value)!=null&&s.includes("stp")?(k(),I(t(qe),{key:0})):(k(),I(t(qe),{style:{color:"#0960bd"},key:"off",onClick:ua}))]}),_:1},8,["title"]),p(t(J),{title:t(u)("routes.dashboard.dash.reset")},{default:f(()=>{var s;return[(s=se.value)!=null&&s.includes("rst")?(k(),I(t(Ie),{key:0})):(k(),I(t(Ie),{style:{color:"#0960bd"},key:"reset",onClick:sa}))]}),_:1},8,["title"])])]),_:1},8,["onRegister"]),p(t(Oe),{onRegister:t(Qe),class:"w-1/2"},null,8,["onRegister"])]),p(t(Na),{size:"small",bordered:""},{title:f(()=>[y("div",ou,[y("div",ru,w(t(u)("dev.info.recentData")),1),y("div",iu,w(Te.value),1),p(t(m),{type:"link",loading:o.value.reload,onClick:ye},{icon:f(()=>[o.value.reload?(k(),I(t(Qa),{key:1})):(k(),I(t(Va),{key:0}))]),_:1},8,["loading"])])]),default:f(()=>[(k(!0),xe(Pe,null,Ra(ue.value,(s,l)=>(k(),I(t(Ta),{label:s.name,key:l},{default:f(()=>[z(w(s.val)+" ",1),y("span",nu,w(s.unit),1)]),_:2},1032,["label"]))),128))]),_:1})]),_:1},8,["tab"]),p(t(G),{key:"2",tab:t(u)("dev.info.record")},{default:f(()=>[y("div",cu,[p(t(Ha),{value:Q.value,"onUpdate:value":a[0]||(a[0]=s=>Q.value=s)},null,8,["value"]),p(t(m),{class:"ml-2",onClick:va,disabled:!Q.value},{default:f(()=>[z(w(t(u)("sys.util.search")),1)]),_:1},8,["disabled"]),p(t(J),{class:"ml-2",title:t(u)("dev.info.chart")},{default:f(()=>[p(t(m),{type:"link",disabled:!Q.value,onClick:fa},{default:f(()=>[p(t($a))]),_:1},8,["disabled"])]),_:1},8,["title"])]),p(t(Ne),{onRegister:t(da)},null,8,["onRegister"])]),_:1},8,["tab"]),p(t(G),{key:"3",tab:t(u)("dev.info.warn")},{default:f(()=>[p(t(Ne),{onRegister:t(Ea)},null,8,["onRegister"])]),_:1},8,["tab"]),p(t(G),{key:"4"},{tab:f(()=>[y("span",null,w(t(u)("routes.dashboard.dash.setting")),1)]),default:f(()=>[y("div",du,[y("div",mu,[p(t(Ma),{current:V.value,total:3,pageSize:1,simple:"",onChange:He},null,8,["current"])]),ce(y("div",null,[y("div",pu,[p(t(L),{onRegister:t(ba)},null,8,["onRegister"]),p(t(L),{onRegister:t(Ca)},null,8,["onRegister"])]),y("div",vu,[p(t(m),{type:"default",loading:o.value.batchQueryCompAuto,onClick:ta},{default:f(()=>[z(w(t(u)("sys.util.batchQuery")),1)]),_:1},8,["loading"]),p(t(m),{type:"default",loading:o.value.batchSaveCompAuto,onClick:la},{default:f(()=>[z(w(t(u)("sys.util.batchSave")),1)]),_:1},8,["loading"])])],512),[[de,V.value===1]]),ce(y("div",null,[y("div",hu,[p(t(L),{onRegister:t(Ue)},null,8,["onRegister"])]),y("div",fu,[p(t(L),{onRegister:t(Je)},null,8,["onRegister"])]),y("div",_u,[p(t(m),{type:"default",loading:o.value.batchQueryOtherParams,onClick:oa},{default:f(()=>[z(w(t(u)("sys.util.batchQuery")),1)]),_:1},8,["loading"]),p(t(m),{type:"default",loading:o.value.batchSaveOtherParams,onClick:ra},{default:f(()=>[z(w(t(u)("sys.util.batchSave")),1)]),_:1},8,["loading"])])],512),[[de,V.value===2]]),ce(y("div",null,[y("div",bu,[p(t(L),{onRegister:t(Ye)},null,8,["onRegister"])]),y("div",yu,[p(t(m),{type:"default",loading:o.value.batchQueryHarmParams,onClick:ia},{default:f(()=>[z(w(t(u)("sys.util.batchQuery")),1)]),_:1},8,["loading"]),p(t(m),{type:"default",loading:o.value.batchSaveHarmParams,onClick:na},{default:f(()=>[z(w(t(u)("sys.util.batchSave")),1)]),_:1},8,["loading"])])],512),[[de,V.value===3]])])]),_:1})]),_:1},8,["activeKey"])]),_:1},16,["onRegister"]),p(au,{onRegister:t(Fe)},null,8,["onRegister"]),p(i,{onRegister:t(Fe),onSuccess:ye},null,8,["onRegister"])],64)}}});var cs=Ga(gu,[["__scopeId","data-v-15463ffb"]]);export{cs as default};
