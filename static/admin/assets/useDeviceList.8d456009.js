var i=(c,r,v)=>new Promise((d,B)=>{var E=t=>{try{u(v.next(t))}catch(s){B(s)}},l=t=>{try{u(v.throw(t))}catch(s){B(s)}},u=t=>t.done?d(t.value):Promise.resolve(t.value).then(E,l);u((v=v.apply(c,r)).next())});import"./index.a544321c.js";import{k as m,e as C,x as A}from"./vue.5d40fadb.js";import{c as y}from"./index.4309479a.js";import{N as w}from"./ui.83c3e48a.js";function x(c,r={}){const{interval:v=3e3,immediate:d=!0,maxRetries:B=3,onError:E}=r,l=m(!1),u=m(!1),t=m(null),s=m(null),o=m(0);let n=null;const F=C(()=>l.value&&!u.value?"\u8F6E\u8BE2\u4E2D":u.value?"\u5DF2\u6682\u505C":"\u5DF2\u505C\u6B62"),f=()=>i(this,null,function*(){try{const D=yield c();return t.value=D,s.value=null,o.value=0,D}catch(D){throw console.error("[Polling] \u6267\u884C\u5931\u8D25:",D),s.value=D,o.value<B?(o.value++,console.log(`[Polling] \u91CD\u8BD5 (${o.value}/${B})`)):(E==null||E(D),a()),D}}),g=()=>i(this,null,function*(){if(!(!l.value||u.value)){try{yield f()}catch(D){}l.value&&!u.value&&(n=window.setTimeout(g,v))}}),e=()=>i(this,null,function*(){if(l.value){console.warn("[Polling] \u5DF2\u7ECF\u5728\u8F6E\u8BE2\u4E2D");return}l.value=!0,u.value=!1,o.value=0,d&&(yield f()),g()}),a=()=>{u.value=!0,n&&(clearTimeout(n),n=null)},P=()=>{if(!l.value){console.warn("[Polling] \u8F6E\u8BE2\u672A\u542F\u52A8");return}if(!u.value){console.warn("[Polling] \u8F6E\u8BE2\u672A\u6682\u505C");return}u.value=!1,o.value=0,g()},p=()=>{l.value=!1,u.value=!1,o.value=0,n&&(clearTimeout(n),n=null)},h=()=>{p(),t.value=null,s.value=null};return A(()=>{p()}),{isPolling:l,isPaused:u,latestData:t,error:s,retryCount:o,statusText:F,start:e,pause:a,resume:P,stop:p,reset:h,execute:f}}function N(){const c=m([]),r=m(!1),v=m(null),{isPolling:d,start:B,stop:E,pause:l,resume:u}=x(()=>i(this,null,function*(){return[]}),{interval:3e3,immediate:!1,maxRetries:3,onError:e=>{w.error("\u8BBE\u5907\u5217\u8868\u67E5\u8BE2\u5931\u8D25"),console.error("[useDeviceList] \u67E5\u8BE2\u5931\u8D25:",e)}}),t=C(()=>c.value.filter(e=>e.limit&&!e.limit.includes("run")).length),s=C(()=>c.value.filter(e=>e.warn).length),o=e=>i(this,null,function*(){try{r.value=!0,yield y({id:e.id,mode:"run"}),w.success("\u8BBE\u5907\u542F\u52A8\u6210\u529F"),yield f()}catch(a){throw w.error("\u8BBE\u5907\u542F\u52A8\u5931\u8D25"),console.error("[useDeviceList] \u542F\u52A8\u5931\u8D25:",a),a}finally{r.value=!1}}),n=e=>i(this,null,function*(){try{r.value=!0,yield y({id:e.id,mode:"stp"}),w.success("\u8BBE\u5907\u505C\u6B62\u6210\u529F"),yield f()}catch(a){throw w.error("\u8BBE\u5907\u505C\u6B62\u5931\u8D25"),console.error("[useDeviceList] \u505C\u6B62\u5931\u8D25:",a),a}finally{r.value=!1}}),F=e=>i(this,null,function*(){try{r.value=!0,yield y({id:e.id,mode:"rst"}),w.success("\u8BBE\u5907\u91CD\u7F6E\u6210\u529F"),yield f()}catch(a){throw w.error("\u8BBE\u5907\u91CD\u7F6E\u5931\u8D25"),console.error("[useDeviceList] \u91CD\u7F6E\u5931\u8D25:",a),a}finally{r.value=!1}}),f=()=>i(this,null,function*(){return[]});return{devices:c,loading:r,error:v,isPolling:d,onlineCount:t,faultCount:s,startPolling:B,stopPolling:E,pausePolling:l,resumePolling:u,startDevice:o,stopDevice:n,resetDevice:F,refetch:f,setDevices:e=>{c.value=e}}}export{N as a,x as u};
