var o=(i,r,c)=>new Promise((w,y)=>{var B=t=>{try{e(c.next(t))}catch(l){y(l)}},a=t=>{try{e(c.throw(t))}catch(l){y(l)}},e=t=>t.done?w(t.value):Promise.resolve(t.value).then(B,a);e((c=c.apply(i,r)).next())});import"./index.f8dcff9b.js";import{k as m,e as F,x}from"./vue.2e68d871.js";import{c as h}from"./index.2a183fc3.js";import{K as p}from"./ui.3c499a62.js";function T(i,r={}){const{interval:c=3e3,immediate:w=!0,maxRetries:y=3,onError:B}=r,a=m(!1),e=m(!1),t=m(null),l=m(null),s=m(0);let n=null;const E=F(()=>a.value&&!e.value?"\u8F6E\u8BE2\u4E2D":e.value?"\u5DF2\u6682\u505C":"\u5DF2\u505C\u6B62"),v=()=>o(this,null,function*(){try{const d=yield i();return t.value=d,l.value=null,s.value=0,d}catch(d){throw l.value=d,s.value<y?s.value++:(B==null||B(d),f()),d}}),D=()=>o(this,null,function*(){if(!(!a.value||e.value)){try{yield v()}catch(d){}a.value&&!e.value&&(n=window.setTimeout(D,c))}}),u=()=>o(this,null,function*(){a.value||(a.value=!0,e.value=!1,s.value=0,w&&(yield v()),D())}),f=()=>{e.value=!0,n&&(clearTimeout(n),n=null)},C=()=>{!a.value||!e.value||(e.value=!1,s.value=0,D())},g=()=>{a.value=!1,e.value=!1,s.value=0,n&&(clearTimeout(n),n=null)},P=()=>{g(),t.value=null,l.value=null};return x(()=>{g()}),{isPolling:a,isPaused:e,latestData:t,error:l,retryCount:s,statusText:E,start:u,pause:f,resume:C,stop:g,reset:P,execute:v}}function U(){const i=m([]),r=m(!1),c=m(null),{isPolling:w,start:y,stop:B,pause:a,resume:e}=T(()=>o(this,null,function*(){return[]}),{interval:3e3,immediate:!1,maxRetries:3,onError:u=>{p.error("\u8BBE\u5907\u5217\u8868\u67E5\u8BE2\u5931\u8D25")}}),t=F(()=>i.value.filter(u=>u.limit&&!u.limit.includes("run")).length),l=F(()=>i.value.filter(u=>u.warn).length),s=u=>o(this,null,function*(){try{r.value=!0,yield h({id:u.id,mode:"run"}),p.success("\u8BBE\u5907\u542F\u52A8\u6210\u529F"),yield v()}catch(f){throw p.error("\u8BBE\u5907\u542F\u52A8\u5931\u8D25"),f}finally{r.value=!1}}),n=u=>o(this,null,function*(){try{r.value=!0,yield h({id:u.id,mode:"stp"}),p.success("\u8BBE\u5907\u505C\u6B62\u6210\u529F"),yield v()}catch(f){throw p.error("\u8BBE\u5907\u505C\u6B62\u5931\u8D25"),f}finally{r.value=!1}}),E=u=>o(this,null,function*(){try{r.value=!0,yield h({id:u.id,mode:"rst"}),p.success("\u8BBE\u5907\u91CD\u7F6E\u6210\u529F"),yield v()}catch(f){throw p.error("\u8BBE\u5907\u91CD\u7F6E\u5931\u8D25"),f}finally{r.value=!1}}),v=()=>o(this,null,function*(){return[]});return{devices:i,loading:r,error:c,isPolling:w,onlineCount:t,faultCount:l,startPolling:y,stopPolling:B,pausePolling:a,resumePolling:e,startDevice:s,stopDevice:n,resetDevice:E,refetch:v,setDevices:u=>{i.value=u}}}export{U as a,T as u};
