# 有人WiFi232-B2模块配置指南

## 📡 配置目标

实现WiFi232-B2模块的双Socket模式：
- **Socket A**: 连接到服务器（现有功能）
- **Socket B**: 作为TCP Server，支持局域网直连（新增功能）

## 🔧 所需工具

1. **配置软件**: USR-TCP232-Test（从有人官网下载）
2. **网络环境**: 电脑和WiFi模块在同一局域网

## 📝 配置步骤

### 步骤1：连接模块

1. 将WiFi232-B2模块连接到局域网（通过WiFi或有线）
2. 打开USR-TCP232-Test配置软件
3. 点击"搜索设备"，找到你的WiFi模块

### 步骤2：基本参数配置

进入模块配置页面，设置以下参数：

#### 网络设置
```
工作模式: STA（连接到路由器）
IP获取方式: DHCP（自动获取）或 Static（固定IP，推荐）
```

#### 串口参数
根据你的设备串口设置：
```
波特率: 115200（或你的设备要求的波特率）
数据位: 8
停止位: 1
校验位: None
流控: None
```

### 步骤3：Socket A配置（服务器通道）

```
协议: TCP Client
远程服务器IP: 127.0.0.1（或你的服务器IP）
远程服务器端口: 8000（或你的服务器端口）

连接模式: 长连接
心跳包: 启用
心跳间隔: 60秒
心跳内容: PING（可选）

重连间隔: 1000ms
```

### 步骤4：Socket B配置（直连通道）✨ 新增

```
协议: TCP Server
本地端口: 18899
最大连接数: 4
```

### 步骤5：高级设置

```
数据包最大长度: 1024（根据需要调整）
串口数据打包时间: 50ms
注册包: 不启用（或根据需要）
心跳包: 启用
透传模式: 启用
```

### 步骤6：保存并重启

1. 点击"设置参数"按钮
2. 等待模块重启（约10秒）
3. 重新搜索设备，确认配置生效

## ✅ 验证配置

### 方法1：使用配置工具验证

1. 在USR-TCP232-Test中，查看"设备状态"
2. 确认：
   - Socket A显示"已连接"（连接到服务器）
   - Socket B显示"监听中"（等待客户端连接）

### 方法2：使用测试页面验证

1. 访问管理后台测试页面（待添加路由）
2. 输入设备ID
3. 点击"连接设备"
4. 观察连接状态：
   - 🔵 **直连模式** - 说明Socket B工作正常
   - 🟢 **服务器模式** - Socket B不可达，使用降级模式

## 📊 配置示例（完整参数）

```ini
[网络参数]
工作模式=STA
IP地址=192.168.1.100（固定IP，可选）
子网掩码=255.255.255.0
网关=192.168.1.1
DNS=8.8.8.8

[串口参数]
波特率=115200
数据位=8
停止位=1
校验位=None
流控=None

[Socket A - 服务器通道]
协议=TCP Client
远程IP=127.0.0.1
远程端口=8000
心跳=启用
心跳间隔=60秒

[Socket B - 直连通道]
协议=TCP Server
本地端口=18899
最大连接=4
```

## 🔍 常见问题

### Q1: Socket B无法连接

**可能原因:**
1. 端口18899被占用
2. 防火墙阻止
3. 不在同一局域网

**解决方法:**
1. 更换端口（需同步修改后端代码）
2. 关闭防火墙或添加规则
3. 确认设备和客户端在同一网络

### Q2: Socket A和B只能工作一个

**可能原因:**
- 未启用双Socket模式

**解决方法:**
- 确认模块固件版本支持双Socket
- 在配置软件中明确启用"Socket A+B"模式

### Q3: 数据收发异常

**可能原因:**
1. 串口参数不匹配
2. 数据包打包时间设置不当
3. 透传模式未启用

**解决方法:**
1. 检查串口参数与设备是否一致
2. 调整打包时间（推荐50ms）
3. 启用透传模式

### Q4: 如何查看模块IP

**方法1**: 在配置软件中查看设备列表
**方法2**: 登录路由器查看DHCP分配记录
**方法3**: 使用ping扫描工具扫描局域网

## 📱 测试命令

### Windows命令行测试Socket B

```powershell
# 测试端口是否开放
Test-NetConnection -ComputerName 192.168.1.100 -Port 18899

# 使用telnet测试
telnet 192.168.1.100 18899
```

### Linux/Mac测试

```bash
# 测试端口
nc -zv 192.168.1.100 18899

# 建立连接
telnet 192.168.1.100 18899
```

## 🔐 安全建议

1. **设置连接密码**: 在配置中启用Socket密码保护
2. **限制连接数**: Socket B最大连接数设为1-2
3. **固定IP**: 使用静态IP，避免IP变化导致无法连接
4. **网络隔离**: 将设备放在独立VLAN（可选）

## 📞 技术支持

- 有人官网: http://www.usr.cn
- 技术文档: 下载《WiFi232-B2用户手册》
- 配置软件: USR-TCP232-Test V1.3+

## 📅 配置记录

建议记录以下信息：

```
模块MAC地址: __________________
模块IP地址: __________________
Socket A端口: __________________
Socket B端口: 18899
配置日期: __________________
配置人员: __________________
```

## 🚀 下一步

配置完成后：
1. 重启服务器PHP服务
2. 访问管理后台
3. 进入测试页面（需添加路由）
4. 测试直连功能

---

**注意**: 本配置会同时保留服务器连接和直连功能，互不影响。直连失败时会自动降级到服务器模式。


